<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SonipatHomeService.com - Book Geyser Service</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <style>
        /* Custom CSS for Geyser Service */
        /* Using Inter font for a modern look */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        :root {
            --primary: #F0F0F0; /* Very Light Gray */
            --secondary: #E0E0E0; /* Slightly Darker Light Gray */
            --accent: #FFD700; /* Gold */
            --light: #212121; /* Dark text for light background */
            --dark: #424242; /* Medium dark for contrast elements */
            --success: #4caf50;
            --warning: #ff9800;
            --card-bg: #ffffff;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif; /* Applied Inter font */
        }

        body {
            background: linear-gradient(135deg, #F0F0F0 0%, #E0E0E0 100%); /* Light gray gradient background */
            color: var(--light); /* Dark text on light background */
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Main content area styling - Adjusted for better responsiveness */
        main {
            padding-top: 6rem; /* Adjusted for header height on smaller screens */
            max-width: 1700px;
            margin: 0 auto;
            padding: 6rem 1rem 3rem; /* Responsive padding */
        }

        /* Stats Section - Using Grid for responsiveness */
        .lottery-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); /* Smaller min-width for mobile */
            gap: 1rem; /* Responsive gap */
            margin-bottom: 2rem; /* Responsive margin */
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.8); /* Slightly transparent white */
            border-radius: 0.625rem; /* 10px */
            padding: 1rem; /* Responsive padding */
            text-align: center;
            backdrop-filter: blur(5px); /* Lighter blur for light background */
            transition: var(--transition);
            border: 1px solid rgba(255, 215, 0, 0.2); /* Accent gold border */
        }

        .stat-card:hover {
            transform: translateY(-0.3125rem); /* 5px */
            box-shadow: var(--shadow);
            border-color: var(--accent); /* Accent gold border on hover */
        }

        .stat-card h3 {
            font-size: 0.95rem; /* Smaller font for mobile */
            margin-bottom: 0.3rem;
            color: var(--dark); /* Darker text for headings */
        }

        .stat-card p {
            font-size: 1.5rem; /* Responsive font size */
            font-weight: 700;
            color: var(--light); /* Dark text */
        }

        /* Product Section Styling */
        .product-section {
            background: rgba(255, 255, 255, 0.8); /* Slightly transparent white */
            border-radius: 0.9375rem; /* 15px */
            overflow: hidden;
            margin-bottom: 2rem; /* Responsive margin */
            backdrop-filter: blur(5px); /* Lighter blur */
            border: 1px solid rgba(255, 215, 0, 0.2); /* Accent gold border */
        }

        .product-header {
            background: linear-gradient(90deg, #D0D0D0, #C0C0C0); /* Subtle gray gradient */
            padding: 1.25rem; /* Responsive padding */
            text-align: center;
        }

        .product-header h2 {
            font-size: 1.75rem; /* Responsive font size */
            margin-bottom: 0.5rem;
            color: var(--dark); /* Dark text for headings */
        }

        .product-content {
            display: flex;
            flex-wrap: wrap; /* Allows wrapping on smaller screens */
            padding: 1.5rem; /* Responsive padding */
            align-items: center;
            justify-content: center;
            gap: 1.5rem; /* Gap between image and details */
        }

        .product-image {
            flex: 1; /* Allows image to take available space */
            min-width: 280px; /* Minimum width for the image container */
            max-width: 100%; /* Ensure it doesn't overflow */
            height: auto; /* Maintain aspect ratio */
            border-radius: 0.625rem; /* Rounded corners for the image container */
            overflow: hidden; /* Hide overflow for rounded corners */
            background: url('https://placehold.co/600x400/D0D0D0/FFD700?text=Geyser+Service') no-repeat center center; /* Placeholder image with light gray and gold text */
            background-size: cover;
            min-height: 250px; /* Minimum height for the image container */
        }

        .product-details {
            flex: 2;
            min-width: 280px; /* Minimum width for details */
            padding: 1rem;
        }

        .price-container {
            display: flex;
            flex-wrap: wrap; /* Allow prices to wrap */
            align-items: center;
            gap: 1rem; /* Responsive gap */
            margin: 1rem 0;
        }

        .original-price {
            font-size: 1.5rem; /* Responsive font size */
            text-decoration: line-through;
            color: #888; /* Medium gray */
        }

        .lottery-price {
            font-size: 2rem; /* Responsive font size */
            font-weight: 700;
            color: var(--accent); /* Accent gold */
        }

        .features {
            margin: 1rem 0;
        }

        .features h3 {
            margin-bottom: 0.8rem;
            color: var(--dark); /* Darker text for headings */
        }

        .features ul {
            padding-left: 1.2rem;
        }

        .features li {
            margin-bottom: 0.4rem;
            font-size: 0.95rem; /* Responsive font size */
            color: var(--light); /* Dark text */
        }

        .action-buttons {
            display: flex;
            gap: 0.8rem; /* Responsive gap */
            flex-wrap: wrap; /* Allow buttons to wrap */
            margin-top: 1.5rem;
        }

        .btn {
            padding: 0.75rem 1.25rem; /* Responsive padding */
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            font-size: 0.95rem; /* Responsive font size */
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
            justify-content: center;
            flex-grow: 1; /* Allow buttons to grow and fill space */
            max-width: 100%; /* Ensure buttons don't overflow */
        }

        .btn-primary {
            background: linear-gradient(90deg, var(--accent), #FFC107); /* Gold to Amber gradient */
            color: #212121; /* Dark text for contrast */
        }

        .btn-primary:hover {
            transform: translateY(-0.1875rem); /* 3px */
            box-shadow: 0 0.3125rem 0.9375rem rgba(255, 215, 0, 0.4); /* Accent gold shadow */
        }

        .btn-secondary {
            background: transparent;
            color: var(--dark); /* Dark text for secondary button */
            border: 2px solid var(--dark); /* Dark border */
        }

        .btn-secondary:hover {
            background: rgba(66, 66, 66, 0.1); /* Dark transparent background */
        }

        /* Popup Styles */
        #popup-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5); /* Lighter overlay for light theme */
            backdrop-filter: blur(8px); /* Lighter blur */
            -webkit-backdrop-filter: blur(8px);
            z-index: 999;
        }

        .popup {
            display: none;
            background: #fdfdfd; /* Very light background for popup */
            color: var(--light); /* Dark text */
            padding: 1.5rem; /* Responsive padding */
            border-radius: 1.25rem; /* 20px */
            box-shadow: 0 0 1.875rem rgba(0, 0, 0, 0.2); /* Subtle dark shadow */
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
            width: 95%; /* Wider on small screens */
            max-width: 550px; /* Slightly larger max-width */
            max-height: 95vh; /* Max height for scrollable content */
            overflow-y: auto;
            animation: fadeIn 0.3s ease-out forwards; /* Fade in animation */
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translate(-50%, -45%); }
            to { opacity: 1; transform: translate(-50%, -50%); }
        }

        /* Specific style for the service category selection popup to ensure centering */
        #serviceCategorySelectionPopup {
            position: fixed; /* Ensures it's positioned relative to the viewport */
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%); /* Centers the element */
            z-index: 1001; /* Higher than overlay, lower than main popups if needed */
            background: #fdfdfd; /* Very light background for popup */
            color: var(--light); /* Dark text */
            padding: 1.5rem;
            border-radius: 1.25rem;
            box-shadow: 0 0 1.875rem rgba(0, 0, 0, 0.2);
            width: 95%;
            max-width: 550px;
            max-height: 95vh;
            overflow-y: auto;
            display: none; /* Hidden by default */
        }

        #serviceCategoryCheckboxes {
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); /* Adjust column width for checkboxes */
        }
        
        .popup input,
        .popup button,
        .popup select,
        .popup textarea {
            width: 100%;
            padding: 0.75rem; /* Responsive padding */
            margin: 0.625rem 0; /* Responsive margin */
            border-radius: 0.625rem; /* 10px */
            border: none;
            font-size: 1rem; /* Responsive font size */
        }
        
        .popup input,
        .popup textarea {
            background: #e0e0e0; /* Light gray input background */
            color: #000;
        }
        
        .popup textarea {
            min-height: 6.25rem; /* 100px */
            resize: vertical;
        }
        
        .popup label {
            display: block;
            margin-bottom: 0.3125rem; /* 5px */
            color: var(--dark); /* Dark text for labels */
            font-size: 0.95rem; /* Responsive font size */
        }
        
        .popup button[type="submit"],
        .popup button#okayBtn,
        #razorpay-payment-btn,
        #downloadTicketsBtn {
            background: linear-gradient(90deg, var(--accent), #FFC107); /* Gold to Amber gradient */
            color: #212121; /* Dark text for contrast */
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            padding: 0.75rem; /* Responsive padding */
            margin-top: 0.9375rem; /* 15px */
            border-radius: 0.625rem; /* 10px */
            border: none;
            font-size: 1rem; /* Responsive font size */
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .popup button[type="submit"]:hover,
        .popup button#okayBtn:hover,
        #razorpay-payment-btn:hover,
        #downloadTicketsBtn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(255, 215, 0, 0.5); /* Accent gold shadow */
        }
        
        #ticketDisplay {
            font-weight: bold;
            color: var(--light); /* Dark text for ticket display */
            font-size: 1.1rem; /* Responsive font size */
            word-break: break-word;
            text-align: center;
            max-height: 12.5rem; /* 200px */
            overflow-y: auto;
            padding: 0.625rem; /* 10px */
            background: rgba(0,0,0,0.05); /* Very light transparent dark background */
            border-radius: 0.625rem; /* 10px */
            margin: 0.625rem 0;
        }

        #countryError {
            color: red;
            font-size: 0.8rem; /* Responsive font size */
            display: none;
            margin-top: -0.3125rem; /* -5px */
            margin-bottom: 0.625rem; /* 10px */
        }

        #submitMessage {
            color: #4caf50; /* Green for success message */
            font-size: 1rem; /* Responsive font size */
            text-align: center;
            margin-top: 0.625rem; /* 10px */
            display: none;
        }
        
        #timerDisplay {
            font-size: 1.1rem; /* Responsive font size */
            font-weight: bold;
            color: var(--accent); /* Accent gold */
            text-align: center;
            margin-top: 0.9375rem; /* 15px */
        }

        .quantity-selector {
            margin: 0.9375rem 0; /* Responsive margin */
        }
        
        .quantity-selector label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--dark); /* Dark text for labels */
        }
        
        .quantity-info {
            display: flex;
            justify-content: space-between;
            margin-top: 0.3125rem; /* 5px */
            font-size: 0.85rem; /* Responsive font size */
            color: #666; /* Slightly darker gray for info text */
        }
        
        .total-price {
            font-size: 1.1rem; /* Responsive font size */
            font-weight: bold;
            color: var(--accent); /* Accent gold */
            text-align: right;
            margin: 0.625rem 0;
        }

        /* Custom Alert Box */
        .custom-alert {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #FFC107; /* Amber */
            color: #212121; /* Dark text for contrast */
            padding: 1.25rem 1.875rem; /* Responsive padding */
            border-radius: 0.625rem; /* 10px */
            z-index: 1002;
            box-shadow: 0 0.3125rem 0.9375rem rgba(0,0,0,0.4); /* 5px 15px */
            font-size: 1rem; /* Responsive font size */
            text-align: center;
            max-width: 90%; /* Responsive width */
            animation: fadeInOut 4s forwards;
        }

        @keyframes fadeInOut {
            0% { opacity: 0; transform: translate(-50%, -40%); }
            10% { opacity: 1; transform: translate(-50%, -50%); }
            90% { opacity: 1; transform: translate(-50%, -50%); }
            100% { opacity: 0; transform: translate(-50%, -60%); display: none; }
        }

        /* Media Queries for fine-tuning responsiveness */
        @media (max-width: 1024px) {
            main {
                padding: 5rem 1rem 2rem;
            }
            .product-header h2 {
                font-size: 1.5rem;
            }
            .product-content {
                flex-direction: column;
                padding: 1rem;
            }
            .product-image {
                min-height: 200px;
                width: 100%;
            }
            .product-details {
                min-width: unset; /* Remove min-width on smaller screens */
                width: 100%;
                text-align: center; /* Center text for better mobile layout */
            }
            .price-container, .action-buttons {
                justify-content: center; /* Center elements in these containers */
            }
            .btn {
                width: 100%;
                max-width: 300px;
            }
            .lottery-stats {
                grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            }
            .stat-card {
                padding: 0.8rem;
            }
            .stat-card h3 {
                font-size: 0.85rem;
            }
            .stat-card p {
                font-size: 1.3rem;
            }
            .popup {
                padding: 1rem;
            }
            .popup input, .popup button, .popup select, .popup textarea {
                font-size: 0.9rem;
                padding: 0.6rem;
            }
        }

        @media (max-width: 768px) {
            main {
                padding-top: 4rem;
            }
            .product-header h2 {
                font-size: 1.3rem;
            }
            .original-price {
                font-size: 1.3rem;
            }
            .lottery-price {
                font-size: 1.8rem;
            }
            .features li {
                font-size: 0.9rem;
            }
            .btn {
                font-size: 0.85rem;
                padding: 0.6rem 1rem;
            }
            .lottery-stats {
                grid-template-columns: 1fr 1fr;
            }
        }

        @media (max-width: 480px) {
            main {
                padding: 3rem 0.5rem 1rem;
            }
            .product-header h2 {
                font-size: 1.2rem;
            }
            .product-content {
                padding: 0.8rem;
            }
            .product-image {
                min-height: 180px;
            }
            .original-price {
                font-size: 1.2rem;
            }
            .lottery-price {
                font-size: 1.6rem;
            }
            .features ul {
                padding-left: 1rem;
            }
            .features li {
                font-size: 0.85rem;
            }
            .action-buttons {
                flex-direction: column;
            }
            .btn {
                width: 100%;
                max-width: unset;
            }
            .lottery-stats {
                grid-template-columns: 1fr;
            }
            .stat-card {
                padding: 0.7rem;
            }
            .stat-card h3 {
                font-size: 0.8rem;
            }
            .stat-card p {
                font-size: 1.1rem;
            }
            .popup {
                padding: 1rem;
                width: 98%;
            }
            .popup h2 {
                font-size: 1.3rem;
            }
            .popup input, .popup button, .popup select, .popup textarea {
                font-size: 0.85rem;
                padding: 0.5rem;
            }
            #ticketDisplay {
                font-size: 0.95rem;
            }
            .custom-alert {
                font-size: 0.9rem;
                padding: 1rem 1.5rem;
            }
        }
    </style>
</head>
<body>
   
    <main class="container mx-auto px-4 py-8">
        
        <section class="product-section rounded-2xl shadow-lg mb-8">
            <div class="product-header rounded-t-2xl">
                <h2 class="text-3xl md:text-4xl font-bold text-dark">Book Geyser Service</h2>
            </div>

            <div class="product-content flex flex-col md:flex-row items-center justify-center p-6 md:p-8 gap-6">
                <div class="product-details w-full md:w-1/2 lg:w-3/5 text-center md:text-left">
                    <h3 class="text-2xl md:text-3xl font-semibold text-dark mb-3">Book Professional Geyser Service & Repair</h3>
                    <p class="text-gray-600 mb-4 text-base md:text-lg">Get expert geyser service. Select your geyser service category to see the transparent pricing. Our certified technicians will ensure your geyser is running at peak performance.</p>
                    
                    <div class="price-container flex flex-col md:flex-row items-center justify-center md:justify-start gap-4 my-6">
                        <div class="original-price text-gray-500 text-xl md:text-2xl line-through">Varies by service category</div>
                        <div class="lottery-price text-accent text-3xl md:text-4xl font-bold" id="displayPrice">Select Geyser Service Category</div>
                    </div>
                    
                   <div class="features text-left my-6">
    <h3 class="text-xl md:text-2xl font-semibold text-dark mb-3">Geyser Service Features:</h3>
    <ul class="list-disc list-inside text-gray-600 text-base md:text-lg space-y-2">

        <!-- Professional Technicians -->
        <li class="font-bold text-dark mt-4">üë®‚Äçüîß Professional Technicians</li>
        <li><i class="fas fa-check-circle text-green-600 mr-2"></i>All work carried out by certified and experienced technicians</li>
        
        <!-- Diagnosis & Inspection -->
        <li class="font-bold text-dark mt-4">üîç Diagnosis & Inspection</li>
        <li><i class="fas fa-check-circle text-green-600 mr-2"></i>On-site diagnosis and detailed problem assessment</li>
        <li><i class="fas fa-check-circle text-green-600 mr-2"></i>Rapid response for urgent geyser breakdowns</li>
        <li><i class="fas fa-check-circle text-green-600 mr-2"></i>Initial visiting charge ‚Çπ299 (adjustable based on distance in Sonipat)</li>
        
        <!-- Repair & Maintenance -->
        <li class="font-bold text-dark mt-4">üõ†Ô∏è Repair & Maintenance</li>
        <li><i class="fas fa-check-circle text-green-600 mr-2"></i>Geyser Heating Rod Change Service</li>
        <li><i class="fas fa-check-circle text-green-600 mr-2"></i>Geyser Sensor Change Service</li>
        <li><i class="fas fa-check-circle text-green-600 mr-2"></i>Solutions for various emergency geyser problems (e.g., no hot water, leakage, heating issues)</li>
        <li><i class="fas fa-check-circle text-green-600 mr-2"></i>Transparent pricing for parts and additional labor provided after diagnosis</li>
        
        <!-- Transparency & Pricing -->
        <li class="font-bold text-dark mt-4">üí∞ Transparency & Pricing</li>
        <li><i class="fas fa-check-circle text-green-600 mr-2"></i>Transparent pricing for parts and additional labor charges</li>
        
        <!-- Customer Support -->
        <li class="font-bold text-dark mt-4">üìû Customer Support</li>
        <li><i class="fas fa-check-circle text-green-600 mr-2"></i>Free basic demonstration of geyser functions</li>
        <li><i class="fas fa-check-circle text-green-600 mr-2"></i>Priority scheduling for urgent service</li>
        <li><i class="fas fa-check-circle text-green-600 mr-2"></i>Quick resolution (special attention for emergency calls)</li>
        
        <!-- Warranty & Guarantee -->
        <li class="font-bold text-dark mt-4">‚úÖ Warranty & Guarantee</li>
        <li><i class="fas fa-check-circle text-green-600 mr-2"></i>1-year service warranty on installation work</li>
        <li><i class="fas fa-check-circle text-green-600 mr-2"></i>1-month warranty on repairs and part replacements</li>
        <li><i class="fas fa-check-circle text-green-600 mr-2"></i>Long-lasting and reliable performance</li>
        
    </ul>
</div>
                    
                    <div class="action-buttons flex flex-col sm:flex-row justify-center md:justify-start gap-4 mt-8">
                        <button class="btn btn-primary shadow-lg hover:shadow-xl" id="participate-btn">
                            <i class="fas fa-thermometer-half"></i> Book Geyser Service
                        </button>
                        <button class="btn btn-secondary shadow-lg hover:shadow-xl" onclick="window.open('index.html')">
                            <i class="fas fa-external-link-alt"></i> Go Back To Home
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <div class="lottery-stats grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
            <div class="stat-card rounded-xl shadow-lg">
                <h3 class="text-accent text-lg font-medium mb-1">Total Customers</h3>
                <p class="text-dark text-3xl font-bold">28,500+</p>
            </div>
            <div class="stat-card rounded-xl shadow-lg">
                <h3 class="text-accent text-lg font-medium mb-1">Geysers Serviced</h3>
                <p class="text-dark text-3xl font-bold">1000+ Monthly</p>
            </div>
            <div class="stat-card rounded-xl shadow-lg">
                <h3 class="text-accent text-lg font-medium mb-1">Customer Rating</h3>
                <p class="text-dark text-3xl font-bold">4.9/5 Stars</p>
            </div>
            <div class="stat-card rounded-xl shadow-lg">
                <h3 class="text-accent text-lg font-medium mb-1">Next Available Slot</h3>
                <p class="text-dark text-3xl font-bold">Today!</p>
            </div>
        </div>
    </main>

    <div id="popup-overlay"></div>
    
    <div class="popup" id="popupForm">
        <h2 class="text-2xl font-bold text-center mb-4 text-dark">Geyser Service Booking</h2>
        <form id="lotteryForm">
            <label for="fullName" class="text-dark text-sm mb-1">Your Full Name (min 10 characters)</label>
            <input type="text" id="fullName" name="field1" required placeholder="John Doe" autocomplete="name" minlength="10" class="rounded-lg bg-gray-200 text-gray-900 p-3 mb-3 focus:outline-none focus:ring-2 focus:ring-yellow-500" />
            
            <label for="phone" class="text-dark text-sm mb-1">Phone Number (10 digits)</label>
            <input type="tel" id="phone" name="field2" required placeholder="9876543210" autocomplete="tel" pattern="[0-9]{10}" class="rounded-lg bg-gray-200 text-gray-900 p-3 mb-3 focus:outline-none focus:ring-2 focus:ring-yellow-500" />
            
            <label for="email" class="text-dark text-sm mb-1">Email Address</label>
            <input type="email" id="email" name="field3" required placeholder="john.doe@example.com" autocomplete="email" class="rounded-lg bg-gray-200 text-gray-900 p-3 mb-3 focus:outline-none focus:ring-2 focus:ring-yellow-500" />
            
            <div class="mb-3">
                <label for="dobField" class="text-dark text-sm mb-1">Date of Birth:</label>
                <input type="date" id="dobField" name="field4" required class="rounded-lg bg-gray-200 text-gray-900 p-3 w-full focus:outline-none focus:ring-2 focus:ring-yellow-500" />
            </div>
            
            <label for="location" class="text-dark text-sm mb-1">Your Location (e.g. Sonipat, Delhi)</label>
            <input type="text" id="location" name="field5" required placeholder="Sonipat" autocomplete="address-level2" list="locations" class="rounded-lg bg-gray-200 text-gray-900 p-3 mb-3 focus:outline-none focus:ring-2 focus:ring-yellow-500" />
            
            <label for="address" class="text-dark text-sm mb-1">Complete Address (min 30 characters)</label>
            <textarea id="address" name="field6" required placeholder="House No, Street, Area, Landmark, City, State, PIN code" autocomplete="street-address" minlength="30" rows="4" class="rounded-lg bg-gray-200 text-gray-900 p-3 w-full mb-2 focus:outline-none focus:ring-2 focus:ring-yellow-500"></textarea>
            <span id="countryError" class="text-red-600 text-xs mt-1 hidden">Please enter your complete address with at least 30 characters.</span>
            
            <div class="quantity-selector my-4">
                <label class="text-dark text-sm mb-2">Select Geyser Service Category:</label>
                <div id="selectedServiceCategoriesDisplay" class="bg-gray-300 text-gray-800 p-3 rounded-lg cursor-pointer mb-3" onclick="openServiceCategorySelectionPopup()">Click to select Geyser service category</div>
                <div id="serviceCategorySelectionPopup" class="popup hidden">
                    <h3 class="text-xl font-bold text-center mb-4 text-dark">Select Geyser Service Category</h3>
                    <div id="serviceCategoryCheckboxes" class="grid grid-cols-2 sm:grid-cols-3 gap-2 text-gray-800 max-h-60 overflow-y-auto">
                        <!-- Checkboxes will be populated by JavaScript -->
                    </div>
                    <button type="button" class="btn btn-primary mt-4 py-2 rounded-xl font-bold text-lg" onclick="applySelectedServiceCategories()">Apply Selection</button>
                    <button type="button" class="btn btn-secondary mt-2 py-2 rounded-xl font-bold text-lg" onclick="closeServiceCategorySelectionPopup()">Cancel</button>
                </div>
            </div>

            <div class="quantity-selector my-4">
                <label class="text-dark text-sm mb-2">Select Service Type:</label>
                <div class="flex flex-col sm:flex-row gap-4 mt-2">
                    <label class="inline-flex items-center text-gray-800">
                        <input type="radio" name="serviceTypeOption" value="Geyser Service" class="form-radio text-yellow-500 h-5 w-5" checked>
                        <span class="ml-2">Geyser Service</span>
                    </label>
                </div>
                <div class="quantity-info flex justify-between mt-2 text-gray-600 text-sm">
                    <span id="servicePriceInfo"></span>
                    <span class="total-price-car-service font-bold text-accent text-lg">Total: ‚Çπ0</span>
                </div>
            </div>

            <div class="quantity-selector my-4">
                <label for="ticketQuantity" class="text-dark text-sm mb-2">Number of Services (Max 5):</label>
                <select id="ticketQuantity" name="ticketQuantity" required class="rounded-lg bg-gray-200 text-gray-900 p-3 w-full focus:outline-none focus:ring-2 focus:ring-yellow-500">
                    <option value="" disabled selected>Select quantity</option>
                    </select>
                <div class="quantity-info flex justify-between mt-2 text-gray-600 text-sm">
                    <span>Quantity based price</span>
                    <span class="total-price-quantity font-bold text-accent text-lg">Total: ‚Çπ0</span>
                </div>
            </div>

            <input type="hidden" name="ticket" id="ticketCode" />
            <input type="hidden" name="finalPrice" id="finalPrice" />
            <button type="submit" class="w-full btn-primary mt-4 py-3 rounded-xl font-bold text-lg transition-all duration-300 hover:scale-105 hover:shadow-xl">Submit Details</button>
            <span id="submitMessage" class="text-green-600 text-center mt-3 hidden">Submitting... Please wait</span>
        </form>
    </div>

    <div class="popup" id="paymentStep">
        <h2 class="text-2xl font-bold text-center mb-4 text-dark">Complete Your Payment for Geyser Service</h2>
        <p class="text-gray-600 text-center mb-6">Please complete the payment to finalize your Geyser Service booking. Click the button below.</p>
        <div id="paymentSummary" class="bg-gray-100 p-4 rounded-lg mb-6 text-center text-dark"></div>
        <div id="timerDisplay" class="text-accent text-xl font-bold text-center mb-6">Time remaining: 05:00</div>
        <button id="razorpay-payment-btn" class="w-full btn-primary py-3 rounded-xl font-bold text-lg transition-all duration-300 hover:scale-105 hover:shadow-xl">Pay with Razorpay</button>
        <p class="mt-4 text-sm text-gray-600 text-center">
            After payment, please wait for automatic verification. Do not close this window.
        </p>
    </div>

    <div class="popup" id="ticketStep">
        <h2 id="welcomeMessage" class="text-2xl font-bold text-center mb-4 text-green-600"></h2>
        <p class="text-gray-600 text-center mb-4">You have successfully booked <span id="ticketCountDisplay" class="font-bold text-accent"></span>:</p>
        <div id="ticketDisplay" class="bg-gray-100 p-4 rounded-lg mb-6 text-center text-lg text-dark"></div>
        <button id="downloadTicketsBtn" class="w-full btn-primary py-3 rounded-xl font-bold text-lg transition-all duration-300 hover:scale-105 hover:shadow-xl">
            <i class="fas fa-download mr-2"></i> Download Service Details
        </button>
        <p class="mt-4 text-sm text-gray-600 text-center">üì∏ Please take a screenshot for proof and reference.</p>
        <button id="okayBtn" class="w-full btn-secondary py-3 rounded-xl font-bold text-dark text-lg mt-4 transition-all duration-300 hover:scale-105 hover:bg-opacity-20">Okay, Got It!</button>
    </div>
   
    <script>
        // CSV Data (hardcoded from your provided Excel sheet) with new Geyser service prices
        const geyserServiceData = [
            { "Category": "Emergency Geyser Service & Diagnosis", "Price": 299, "Features": ["Rapid response for urgent geyser breakdowns", "On-site diagnosis by certified technicians", "Initial visiting charge of ‚Çπ299 (adjustable based on distance in Sonipat)", "Detailed assessment of the geyser issue", "Solutions for various emergency geyser problems (e.g., no hot water, leakage, heating issues)", "Priority scheduling for quick resolution"] },
            { "Category": "Geyser Heating Rod Change Service", "Price": 699, "Features": ["Prompt response for urgent geyser heating issues", "On-site diagnosis and heating rod replacement by certified technicians", "Standard service charge of ‚Çπ699", "Detailed assessment of the geyser heating system", "Transparent pricing for parts and additional labor provided after diagnosis", "Solutions for various geyser heating problems (e.g., no hot water, slow heating)", "Priority scheduling for quick resolution"] },
            { "Category": "Geyser Sensor Change Service", "Price": 249, "Features": ["Prompt response for geyser sensor issues", "On-site diagnosis and sensor replacement by certified technicians", "Standard service charge of ‚Çπ249", "Detailed assessment of the geyser control system", "Transparent pricing for parts and additional labor provided after diagnosis", "Solutions for various geyser sensor problems (e.g., overheating, no heating, error displays)", "Priority scheduling for quick resolution"] }
        ];

        // Popup Elements
        const participateBtn = document.getElementById('participate-btn');
        const popupOverlay = document.getElementById('popup-overlay');
        const allPopups = document.querySelectorAll('.popup');
        const popupForm = document.getElementById('popupForm');
        const paymentStep = document.getElementById('paymentStep');
        const ticketStep = document.getElementById('ticketStep');
        const timerDisplay = document.getElementById('timerDisplay');
        const razorpayBtn = document.getElementById('razorpay-payment-btn');
        const submitMessage = document.getElementById('submitMessage');
        const serviceCategoryCheckboxesContainer = document.getElementById('serviceCategoryCheckboxes'); // Container for checkboxes
        const selectedServiceCategoriesDisplay = document.getElementById('selectedServiceCategoriesDisplay'); // Element to show selected models
        const serviceCategorySelectionPopup = document.getElementById('serviceCategorySelectionPopup'); // The new popup for service category selection
        const serviceTypeOptions = document.querySelectorAll('input[name="serviceTypeOption"]');
        const servicePriceInfo = document.getElementById('servicePriceInfo');
        const totalPriceCarServiceDisplay = document.querySelector('.total-price-car-service');
        const ticketQuantitySelect = document.getElementById('ticketQuantity');
        const totalPriceQuantityDisplay = document.querySelector('.total-price-quantity');
        const paymentSummary = document.getElementById('paymentSummary');
        const ticketCountDisplay = document.getElementById('ticketCountDisplay');
        const downloadTicketsBtn = document.getElementById('downloadTicketsBtn');
        const welcomeMessage = document.getElementById('welcomeMessage');
        const displayPriceElement = document.getElementById('displayPrice');
        const finalPriceInput = document.getElementById('finalPrice');


        // Form & Ticket Elements
        const form = document.getElementById('lotteryForm');
        const ticketInput = document.getElementById('ticketCode');
        const ticketDisplay = document.getElementById('ticketDisplay');
        const okayBtn = document.getElementById('okayBtn');

        let generatedTicket = ''; 
        let paymentTimeout = null;
        let countdownInterval = null;
        const PAYMENT_TIME_LIMIT = 5 * 60; // 5 minutes in seconds
        let currentServicePrice = 0; // Dynamic price based on Geyser service category and quantity
        let selectedQuantity = 1; // Default quantity
        let allowClose = false; // Controls closing of popups


        // Populate Geyser service category checkboxes
        function populateServiceCategories() { // Renamed for clarity
            serviceCategoryCheckboxesContainer.innerHTML = ''; // Clear previous options
            geyserServiceData.forEach(service => {
                const checkboxHtml = `
                    <label class="inline-flex items-center text-gray-800 w-full">
                        <input type="checkbox" name="geyserServiceCategory" value="${service.Category}" data-price="${service.Price}" 
                               class="form-checkbox h-5 w-5 text-yellow-500 rounded focus:ring-yellow-500">
                        <span class="ml-2">${service.Category} (‚Çπ${service.Price})</span>
                    </label>
                `;
                serviceCategoryCheckboxesContainer.insertAdjacentHTML('beforeend', checkboxHtml);
            });

            // Add event listeners to new checkboxes
            serviceCategoryCheckboxesContainer.querySelectorAll('input[name="geyserServiceCategory"]').forEach(checkbox => {
                checkbox.addEventListener('change', updatePrices);
            });
        }

        // Initialize quantity selector
        function initQuantitySelector() {
            const maxServices = 5; 
            ticketQuantitySelect.innerHTML = '<option value="" disabled selected>Select quantity</option>';
            
            for (let i = 1; i <= maxServices; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = i + (i === 1 ? ' service' : ' services'); 
                ticketQuantitySelect.appendChild(option);
            }
            
            // Set default value to 1
            ticketQuantitySelect.value = 1;
        }

        // Update prices based on selected Geyser service category(s) and quantity
        function updatePrices() {
            const selectedGeyserServiceCategories = Array.from(serviceCategoryCheckboxesContainer.querySelectorAll('input[name="geyserServiceCategory"]:checked')).map(checkbox => ({
                category: checkbox.value,
                price: parseFloat(checkbox.dataset.price)
            }));
            selectedQuantity = parseInt(ticketQuantitySelect.value) || 1;

            let totalCalculatedPrice = 0;

            if (selectedGeyserServiceCategories.length > 0) {
                selectedGeyserServiceCategories.forEach(service => {
                    totalCalculatedPrice += service.price;
                });
                currentServicePrice = totalCalculatedPrice;

                servicePriceInfo.textContent = `‚Çπ${currentServicePrice} per service (for selected categories)`; 
                totalPriceCarServiceDisplay.textContent = `Total: ‚Çπ${currentServicePrice}`; 
                displayPriceElement.textContent = `Service Charge: ‚Çπ${currentServicePrice}`; 
                displayPriceElement.style.display = 'block';

            } else {
                currentServicePrice = 0;
                servicePriceInfo.textContent = '';
                totalPriceCarServiceDisplay.textContent = 'Total: ‚Çπ0'; 
                displayPriceElement.textContent = 'Select Geyser Service Category'; 
                displayPriceElement.style.display = 'block';
            }
            finalPriceInput.value = currentServicePrice * selectedQuantity; // Update hidden input
            
            // Update the display in the main form
            if (selectedGeyserServiceCategories.length > 0) {
                selectedServiceCategoriesDisplay.textContent = selectedGeyserServiceCategories.map(s => s.category).join(', ');
            } else {
                selectedServiceCategoriesDisplay.textContent = 'Click to select Geyser service category'; 
            }
            totalPriceQuantityDisplay.textContent = `Total: ‚Çπ${currentServicePrice * selectedQuantity}`; 
        }

        // Generate a single formatted ticket
        function generateFormattedTicket() {
            const uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                const r = Math.random() * 16 | 0,
                    v = c === 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
            return uuid.toUpperCase().replace(/-/g, '').match(/.{1,4}/g).join('-');
        }

        // Download tickets as text file
        function downloadTickets() {
            const selectedGeyserServiceCategoryNames = Array.from(serviceCategoryCheckboxesContainer.querySelectorAll('input[name="geyserServiceCategory"]:checked')).map(checkbox => checkbox.value);
            const serviceTypeName = "Geyser Service"; 
            const selectedServicesDetails = selectedGeyserServiceCategoryNames.join(', ');

            const ticketContent = `Geyser Service Booking Details\n\n` + 
                                 `Customer Name: ${form.field1.value}\n` + 
                                 `Contact: ${form.field2.value}\n` + 
                                 `Location: ${form.field5.value}\n` + 
                                 `Geyser Service Category(s): ${selectedServicesDetails}\n` + 
                                 `Service Type: ${serviceTypeName}\n` + 
                                 `Booking Reference Number: ${generatedTicket}\n\n` + 
                                 `Total Services: ${selectedQuantity}\n` + 
                                 `Service Charge: ‚Çπ${currentServicePrice * selectedQuantity}\n\n` + 
                                 `Note: Final charges for parts and labor will be communicated by the technician after diagnosis.`; 
            
            const blob = new Blob([ticketContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = 'geyser_service_booking.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // --- FUNCTIONS TO CONTROL POPUPS ---
        // Main popup (form and payment steps)
        function closeAllPopups() {
            if (!allowClose) {
                showCustomAlert("Please complete the form or payment process before closing."); 
                return;
            }
            
            clearTimers();
            popupOverlay.style.display = 'none';
            allPopups.forEach(p => p.style.display = 'none');
            document.body.style.overflow = 'auto';
            submitMessage.style.display = 'none';
            allowClose = false; 
        }

        function openPopup(popupElement) {
            document.body.style.overflow = 'hidden';
            popupOverlay.style.display = 'block';
            popupElement.style.display = 'block';
            allowClose = false; 
        }

        function clearTimers() {
            if (paymentTimeout) clearTimeout(paymentTimeout);
            if (countdownInterval) clearInterval(countdownInterval);
            paymentTimeout = null;
            countdownInterval = null;
        }

        // --- Geyser Service Category Selection Popup Functions ---
        function openServiceCategorySelectionPopup() { // Renamed for clarity
            populateServiceCategories(); // Ensure checkboxes are up-to-date
            // Re-check previously selected boxes
            const currentlySelectedCategories = selectedServiceCategoriesDisplay.textContent.split(', ').map(s => s.trim());
            serviceCategoryCheckboxesContainer.querySelectorAll('input[name="geyserServiceCategory"]').forEach(checkbox => {
                if (currentlySelectedCategories.includes(checkbox.value)) {
                    checkbox.checked = true;
                } else {
                    checkbox.checked = false;
                }
            });
            // Open the Geyser service category selection popup and overlay
            serviceCategorySelectionPopup.style.display = 'block';
            popupOverlay.style.display = 'block'; // Ensure overlay is visible
            document.body.style.overflow = 'hidden'; // Prevent scrolling
        }

        function closeServiceCategorySelectionPopup() {
            serviceCategorySelectionPopup.style.display = 'none';
            popupOverlay.style.display = 'none'; // Hide overlay when this specific popup closes
            document.body.style.overflow = 'auto'; // Re-enable scrolling
        }

        function applySelectedServiceCategories() { // Renamed for clarity
            updatePrices(); // Update prices based on current checkbox selection
            closeServiceCategorySelectionPopup();
        }


        // --- EVENT LISTENERS ---
        participateBtn.addEventListener('click', () => {
            // This button now triggers the main form popup, which will then handle Geyser service category selection
            initQuantitySelector(); // Initialize quantity selector
            updatePrices(); // This will update the price based on no category selected initially
            openPopup(popupForm);
        });
        
        // Event listeners for checkboxes are added inside populateServiceCategories
        serviceTypeOptions.forEach(radio => radio.addEventListener('change', updatePrices));
        ticketQuantitySelect.addEventListener('change', updatePrices); 

        // Modified overlay click handler
        popupOverlay.addEventListener('click', function(e) {
            // Check if the click is on the overlay itself, not inside a popup
            if (e.target === popupOverlay) {
                // Determine which popup is currently open and if it allows closing
                if (serviceCategorySelectionPopup.style.display === 'block') {
                    // Geyser service category selection popup is open, close it
                    closeServiceCategorySelectionPopup();
                } else if (ticketStep.style.display === 'block' && allowClose) {
                    // Ticket step is open and allows closing
                    closeAllPopups();
                } else {
                    // Other popups are open and do not allow closing from overlay
                    showCustomAlert("Please complete the form or payment process before closing.");
                }
            }
        });
        
        allPopups.forEach(p => p.addEventListener('click', e => e.stopPropagation()));
        
        // Modified okayBtn event listener to redirect to index.html
        okayBtn.addEventListener('click', function() {
            window.location.href = 'index.html';
        });
        
        razorpayBtn.addEventListener('click', handleRazorpayPayment);
        downloadTicketsBtn.addEventListener('click', downloadTickets);

        form.addEventListener('submit', function(e) {
            e.preventDefault();

            // Client-side validation
            const fullName = form.fullName.value.trim();
            const phone = form.phone.value.trim();
            const email = form.email.value.trim();
            const dob = form.dobField.value;
            const location = form.location.value.trim();
            const address = form.address.value.trim();
            const selectedGeyserServiceCategoryNames = Array.from(serviceCategoryCheckboxesContainer.querySelectorAll('input[name="geyserServiceCategory"]:checked')).map(checkbox => checkbox.value);
            const selectedServiceType = "Geyser Service"; // Hardcoded now
            const selectedQuantityValue = parseInt(ticketQuantitySelect.value);


            if (fullName.length < 10) {
                showCustomAlert("Please enter your full name (minimum 10 characters)."); 
                return;
            }
            if (!/^\d{10}$/.test(phone)) {
                showCustomAlert("Please enter a valid 10-digit phone number."); 
                return;
            }
            if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                showCustomAlert("Please enter a valid email address."); 
                return;
            }
            if (!dob) {
                showCustomAlert("Please select your date of birth."); 
                return;
            }
            if (location.length < 3) {
                showCustomAlert("Please enter a valid location name."); 
                return;
            }
            if (address.length < 30) {
                document.getElementById('countryError').style.display = 'block';
                showCustomAlert("Please enter a complete address with at least 30 characters."); 
                return;
            }
            document.getElementById('countryError').style.display = 'none';

            if (selectedGeyserServiceCategoryNames.length === 0) {
                showCustomAlert("Please select at least one Geyser service category."); 
                return;
            }
            if (currentServicePrice === 0) {
                showCustomAlert("Price not available for the selected Geyser service category(s)."); 
                return;
            }
            if (!selectedQuantityValue || selectedQuantityValue <= 0) {
                showCustomAlert("Please select the number of services."); 
                return;
            }

            submitMessage.style.display = 'block';
            form.querySelector('button[type="submit"]').disabled = true;

            generatedTicket = generateFormattedTicket(); 
            
            // Create FormData object to handle all form inputs
            const formData = new FormData();
            formData.append('field1', fullName);
            formData.append('field2', phone);
            formData.append('field3', email);
            formData.append('field4', dob);
            formData.append('field5', location);
            formData.append('field6', address);
            formData.append('ticket', generatedTicket);
            formData.append('tab', 'geyser-service'); // Updated tab name for Geyser service
            formData.append('geyserServiceCategory', selectedGeyserServiceCategoryNames.join(', ')); // Send all selected Geyser service categories
            formData.append('serviceType', "Geyser Service"); // Send user-friendly name
            formData.append('servicePrice', currentServicePrice); // Send the actual service price for one unit
            formData.append('ticketQuantity', selectedQuantityValue); // Send the selected quantity
            
            fetch(
                "https://script.google.com/macros/s/AKfycbySMwu5qzcIvr8x31T3NYA2T2GfueRcFe4AI6pBLmelVx7zxGq3HpWY8dn91hIsFlBlrQ/exec", {
                    method: "POST",
                    body: formData
                }
            ).then(res => res.text()).then(res => {
                submitMessage.style.display = 'none';
                form.querySelector('button[type="submit"]').disabled = false;

                if (res === "Success") {
                    popupForm.style.display = 'none';
                    openPopup(paymentStep);
                    // Update payment summary
                    const serviceTypeName = "Geyser Service"; 

                    paymentSummary.innerHTML = `
                        <p class="text-gray-600 text-lg mb-2">You are booking <span class="font-bold text-accent">${selectedQuantityValue}</span> ${serviceTypeName} for ${selectedGeyserServiceCategoryNames.join(', ')}.</p> 
                        <p class="total-price text-accent text-2xl font-bold">Service Charge: ‚Çπ${currentServicePrice * selectedQuantityValue}</p> 
                        <p class="text-gray-600 text-sm mt-2">Final charges for parts and labor will be communicated by the technician after diagnosis.</p> 
                    `;
                    startPaymentTimer();
                } else {
                    console.error("Submission failed: " + res);
                    showCustomAlert("There was an error submitting your form. Please try again."); 
                }
            }).catch(err => {
                submitMessage.style.display = 'none';
                form.querySelector('button[type="submit"]').disabled = false;
                console.error("An unexpected error occurred. Please check your connection and try again:", err);
                showCustomAlert("An unexpected error occurred. Please check your connection and try again."); 
            });
        });
        
        // Custom Alert Function (replaces browser's alert)
        function showCustomAlert(message) {
            const alertBox = document.createElement('div');
            alertBox.className = 'custom-alert'; 
            alertBox.textContent = message;
            document.body.appendChild(alertBox);

            setTimeout(() => {
                alertBox.remove();
            }, 4000); 
        }

        // --- RAZORPAY PAYMENT HANDLING ---
        function handleRazorpayPayment() {
            const totalAmount = currentServicePrice * selectedQuantity * 100; // Convert to paise
            const selectedGeyserServiceCategoryNames = Array.from(serviceCategoryCheckboxesContainer.querySelectorAll('input[name="geyserServiceCategory"]:checked')).map(checkbox => checkbox.value);
            const serviceTypeName = "Geyser Service"; 

            const options = {
                "key": "rzp_live_opiqkRmGpjG1hF", // Replace with your actual Razorpay Key ID
                "amount": totalAmount.toString(),
                "currency": "INR",
                "name": document.querySelector('.product-header h2').textContent, 
                "description": `Payment for ${selectedQuantity} ${serviceTypeName} for ${selectedGeyserServiceCategoryNames.join(', ')}`, 
                "image": "https://placehold.co/100x100/D0D0D0/FFD700?text=GR", // Placeholder logo with light gray and gold text
                "handler": function (response){
                    console.log("Payment successful:", response);
                    console.log("Razorpay Payment ID:", response.razorpay_payment_id);
                    paymentSuccess();
                },
                "prefill": {
                    "name": form.field1.value,
                    "email": form.field3.value,
                    "contact": form.field2.value
                },
                "notes": {
                    "address": `${form.field5.value}, ${form.field6.value}`,
                    "service_count": selectedQuantity.toString(),
                    "geyser_service_category": selectedGeyserServiceCategoryNames.join(', '),
                    "service_type": serviceTypeName,
                    "service_price": currentServicePrice.toString(),
                    "initial_charge_note": "Final charges for parts and labor will be communicated by the technician after diagnosis."
                },
                "theme": {
                    "color": "#F0F0F0" /* Light gray theme color */
                },
                "modal": {
                    "ondismiss": function(){
                        console.log('Razorpay checkout modal closed.');
                    }
                }
            };

            const rzp1 = new Razorpay(options);
            rzp1.on('payment.failed', function (response){
                console.error("Payment Failed:", response.error);
                showCustomAlert(`Payment Failed: ${response.error.description} (Code: ${response.error.code})`); 
            });
            rzp1.open();
        }

        function startPaymentTimer() {
            let timeLeft = PAYMENT_TIME_LIMIT;
            updateTimerDisplay(); 

            function updateTimerDisplay() {
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                timerDisplay.textContent = `Time remaining: ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`; 
            }

            countdownInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                if (timeLeft <= 0) {
                    clearInterval(countdownInterval);
                    showCustomAlert("Payment time expired. Please try again."); 
                    allowClose = true; 
                    closeAllPopups();
                }
            }, 1000);

            paymentTimeout = setTimeout(() => {
                if (paymentTimeout) {
                    clearTimers();
                    showCustomAlert("Payment timed out. Please try again."); 
                    allowClose = true; 
                    closeAllPopups();
                }
            }, PAYMENT_TIME_LIMIT * 1000);
        }

        function paymentSuccess() {
            clearTimers();
            paymentStep.style.display = 'none';
            openPopup(ticketStep);
            
            // Display welcome message with user's name
            const userName = form.fullName.value;
            const selectedGeyserServiceCategoryNames = Array.from(serviceCategoryCheckboxesContainer.querySelectorAll('input[name="geyserServiceCategory"]:checked')).map(checkbox => checkbox.value);
            const serviceTypeName = "Geyser Service"; 

            welcomeMessage.textContent = `üéâ Congratulations, ${userName}! Your Geyser Service Booking for ${selectedGeyserServiceCategoryNames.join(', ')} is Confirmed! ÔøΩ`; 
            
            // Display the single ticket number and registration ID
            ticketDisplay.innerHTML = `
                <p>Registration ID: <span class="text-dark">${generatedTicket}</span></p> 
                <p>Service: <span class="text-dark">${serviceTypeName} for ${selectedGeyserServiceCategoryNames.join(', ')}</span></p> 
                <p>Quantity: <span class="text-dark">${selectedQuantity}</span></p> 
                <p class="text-gray-600 text-sm mt-2">Service Charge: ‚Çπ${currentServicePrice * selectedQuantity}</p> 
                <p class="text-gray-600 text-sm">Final charges for parts and labor will be communicated by the technician after diagnosis.</p> 
            `;
            
            // Update download button content
            ticketCountDisplay.textContent = `${selectedQuantity} ${serviceTypeName}`; 
            
            // Allow closing only from the ticket step
            allowClose = true;
        }
        
        // Mobile menu toggle (Assuming an external script or injected header handles this)
        const hamburger = document.querySelector('.hamburger');
        const navLinks = document.querySelector('.nav-links');
        if (hamburger && navLinks) {
            hamburger.addEventListener('click', () => {
                navLinks.classList.toggle('active');
            });
        }

        // Initial population of Geyser service categories when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            populateServiceCategories(); // Function name updated
            initQuantitySelector(); // Initialize quantity selector on load
            updatePrices();
        });
    </script>
</body>
</html>
ÔøΩ
