<!doctype html>
<html lang="en" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ISP Admin Panel</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
        body {
            box-sizing: border-box;
        }
        .admin-card:hover {
            transform: translateY(-2px);
            transition: transform 0.3s ease;
        }
        .loading-spinner {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .tab-active {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
        }
        .tab-inactive {
            background: #f3f4f6;
            color: #6b7280;
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="h-full bg-gradient-to-br from-slate-50 to-blue-50 font-sans"><!-- Admin Header -->
  <header class="bg-white shadow-lg sticky top-0 z-50 border-b-2 border-blue-500">
   <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between items-center py-4">
     <div class="flex items-center space-x-4">
      <div class="w-12 h-12 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-lg flex items-center justify-center">
       <svg class="w-8 h-8 text-white" fill="currentColor" viewbox="0 0 20 20"><path d="M10 12a2 2 0 100-4 2 2 0 000 4z" /> <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd" />
       </svg>
      </div>
      <div>
       <h1 id="company-name" class="text-2xl font-bold text-gray-900">ISP Admin Panel</h1>
       <p id="company-tagline" class="text-sm text-gray-600">Manage Plans &amp; Settings</p>
      </div>
     </div>
     <div class="flex items-center space-x-4">
      <div class="hidden lg:flex items-center space-x-4 text-sm text-gray-600"><span id="contact-phone">📞 88160 14071</span> <span id="contact-email">✉️ admin@sonipathomeservice.com</span>
      </div>
      <div class="flex items-center space-x-2 bg-green-100 text-green-800 px-3 py-1 rounded-full">
       <div class="w-2 h-2 bg-green-500 rounded-full"></div><span class="text-sm font-medium">Admin Mode</span>
      </div>
     </div>
    </div>
   </div>
  </header><!-- Main Admin Content -->
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"><!-- Admin Navigation Tabs -->
   <div class="mb-8">
    <div class="flex flex-wrap gap-2 bg-white p-2 rounded-xl shadow-lg"><button class="admin-tab tab-active px-6 py-3 rounded-lg font-semibold transition-all" data-tab="dashboard"> 📊 Dashboard </button> <button class="admin-tab tab-inactive px-6 py-3 rounded-lg font-semibold transition-all" data-tab="plans"> 📋 Manage Plans </button> <button class="admin-tab tab-inactive px-6 py-3 rounded-lg font-semibold transition-all" data-tab="orders"> 🛒 View Orders </button> <button class="admin-tab tab-inactive px-6 py-3 rounded-lg font-semibold transition-all" data-tab="settings"> ⚙️ Page Settings </button>
    </div>
   </div><!-- Dashboard Tab -->
   <section id="dashboard-tab" class="admin-section">
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8"><!-- Stats Cards -->
     <div class="admin-card bg-white rounded-xl shadow-lg p-6 border-l-4 border-blue-500">
      <div class="flex items-center justify-between">
       <div>
        <p class="text-sm font-medium text-gray-600">Total Plans</p>
        <p id="total-plans" class="text-3xl font-bold text-blue-600">0</p>
       </div>
       <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
        <svg class="w-6 h-6 text-blue-600" fill="currentColor" viewbox="0 0 20 20"><path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
       </div>
      </div>
     </div>
     <div class="admin-card bg-white rounded-xl shadow-lg p-6 border-l-4 border-green-500">
      <div class="flex items-center justify-between">
       <div>
        <p class="text-sm font-medium text-gray-600">Total Orders</p>
        <p id="total-orders" class="text-3xl font-bold text-green-600">0</p>
       </div>
       <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
        <svg class="w-6 h-6 text-green-600" fill="currentColor" viewbox="0 0 20 20"><path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z" />
        </svg>
       </div>
      </div>
     </div>
     <div class="admin-card bg-white rounded-xl shadow-lg p-6 border-l-4 border-purple-500">
      <div class="flex items-center justify-between">
       <div>
        <p class="text-sm font-medium text-gray-600">Active Plans</p>
        <p id="active-plans" class="text-3xl font-bold text-purple-600">0</p>
       </div>
       <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center">
        <svg class="w-6 h-6 text-purple-600" fill="currentColor" viewbox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
        </svg>
       </div>
      </div>
     </div>
     <div class="admin-card bg-white rounded-xl shadow-lg p-6 border-l-4 border-orange-500">
      <div class="flex items-center justify-between">
       <div>
        <p class="text-sm font-medium text-gray-600">Companies</p>
        <p class="text-3xl font-bold text-orange-600">6</p>
       </div>
       <div class="w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center">
        <svg class="w-6 h-6 text-orange-600" fill="currentColor" viewbox="0 0 20 20"><path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z" />
        </svg>
       </div>
      </div>
     </div>
    </div><!-- Quick Actions -->
    <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
     <h3 class="text-xl font-bold text-gray-900 mb-4">Quick Actions</h3>
     <div class="grid grid-cols-1 md:grid-cols-3 gap-4"><button class="quick-action-btn bg-blue-600 text-white p-4 rounded-lg hover:bg-blue-700 transition-colors" data-action="add-plan">
       <div class="text-2xl mb-2">
        ➕
       </div>
       <div class="font-semibold">
        Add New Plan
       </div></button> <button class="quick-action-btn bg-green-600 text-white p-4 rounded-lg hover:bg-green-700 transition-colors" data-action="view-orders">
       <div class="text-2xl mb-2">
        📋
       </div>
       <div class="font-semibold">
        View Recent Orders
       </div></button> <button class="quick-action-btn bg-purple-600 text-white p-4 rounded-lg hover:bg-purple-700 transition-colors" data-action="update-settings">
       <div class="text-2xl mb-2">
        ⚙️
       </div>
       <div class="font-semibold">
        Update Settings
       </div></button>
     </div>
    </div>
   </section><!-- Plans Management Tab -->
   <section id="plans-tab" class="admin-section hidden">
    <div class="flex justify-between items-center mb-6">
     <h2 class="text-2xl font-bold text-gray-900">Manage Internet Plans</h2><button id="add-new-plan-btn" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors font-semibold"> ➕ Add New Plan </button>
    </div><!-- Plans List -->
    <div class="bg-white rounded-xl shadow-lg overflow-hidden">
     <div class="overflow-x-auto">
      <table class="w-full">
       <thead class="bg-gray-50">
        <tr>
         <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Plan Details</th>
         <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Company</th>
         <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Localities</th>
         <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Pricing</th>
         <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
         <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
        </tr>
       </thead>
       <tbody id="plans-table-body" class="bg-white divide-y divide-gray-200"><!-- Plans will be loaded here -->
       </tbody>
      </table>
     </div>
    </div><!-- Loading State -->
    <div id="plans-loading" class="text-center py-8 hidden">
     <div class="loading-spinner w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full mx-auto mb-4"></div>
     <p class="text-gray-600">Loading plans...</p>
    </div><!-- Empty State -->
    <div id="plans-empty" class="text-center py-12 hidden">
     <div class="text-6xl mb-4">
      📋
     </div>
     <h3 class="text-xl font-semibold text-gray-900 mb-2">No Plans Found</h3>
     <p class="text-gray-600 mb-6">Get started by adding your first internet plan.</p><button class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors font-semibold"> Add First Plan </button>
    </div>
   </section><!-- Orders Tab -->
   <section id="orders-tab" class="admin-section hidden">
    <div class="flex justify-between items-center mb-6">
     <h2 class="text-2xl font-bold text-gray-900">Customer Orders</h2>
     <div class="flex space-x-4"><select id="order-filter" class="bg-white border border-gray-300 rounded-lg px-4 py-2"> <option value="all">All Orders</option> <option value="today">Today</option> <option value="week">This Week</option> <option value="month">This Month</option> </select> <button id="export-orders-btn" class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-colors font-semibold"> 📊 Export Data </button>
     </div>
    </div><!-- Orders List -->
    <div class="bg-white rounded-xl shadow-lg overflow-hidden">
     <div class="overflow-x-auto">
      <table class="w-full">
       <thead class="bg-gray-50">
        <tr>
         <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Order ID</th>
         <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Customer</th>
         <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Plan</th>
         <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Price</th>
         <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
         <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Contact</th>
        </tr>
       </thead>
       <tbody id="orders-table-body" class="bg-white divide-y divide-gray-200"><!-- Orders will be loaded here -->
       </tbody>
      </table>
     </div>
    </div><!-- Orders Loading State -->
    <div id="orders-loading" class="text-center py-8 hidden">
     <div class="loading-spinner w-8 h-8 border-4 border-green-500 border-t-transparent rounded-full mx-auto mb-4"></div>
     <p class="text-gray-600">Loading orders...</p>
    </div><!-- Orders Empty State -->
    <div id="orders-empty" class="text-center py-12 hidden">
     <div class="text-6xl mb-4">
      🛒
     </div>
     <h3 class="text-xl font-semibold text-gray-900 mb-2">No Orders Yet</h3>
     <p class="text-gray-600">Customer orders will appear here once they start placing orders.</p>
    </div>
   </section><!-- Settings Tab -->
   <section id="settings-tab" class="admin-section hidden">
    <h2 class="text-2xl font-bold text-gray-900 mb-6">Page Settings</h2>
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8"><!-- Company Information -->
     <div class="bg-white rounded-xl shadow-lg p-6">
      <h3 class="text-xl font-semibold text-gray-900 mb-4">Company Information</h3>
      <form id="company-settings-form" class="space-y-4">
       <div><label for="settings-company-name" class="block text-sm font-medium text-gray-700 mb-2">Company Name</label> <input type="text" id="settings-company-name" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
       </div>
       <div><label for="settings-company-tagline" class="block text-sm font-medium text-gray-700 mb-2">Company Tagline</label> <input type="text" id="settings-company-tagline" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
       </div>
       <div><label for="settings-contact-phone" class="block text-sm font-medium text-gray-700 mb-2">Contact Phone</label> <input type="tel" id="settings-contact-phone" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
       </div>
       <div><label for="settings-contact-email" class="block text-sm font-medium text-gray-700 mb-2">Contact Email</label> <input type="email" id="settings-contact-email" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
       </div><button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition-colors font-semibold"> Update Company Info </button>
      </form>
     </div><!-- Page Content -->
     <div class="bg-white rounded-xl shadow-lg p-6">
      <h3 class="text-xl font-semibold text-gray-900 mb-4">Page Content</h3>
      <form id="page-content-form" class="space-y-4">
       <div><label for="settings-hero-title" class="block text-sm font-medium text-gray-700 mb-2">Hero Section Title</label> <input type="text" id="settings-hero-title" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
       </div>
       <div><label for="settings-hero-description" class="block text-sm font-medium text-gray-700 mb-2">Hero Section Description</label> <textarea id="settings-hero-description" rows="3" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
       </div><button type="submit" class="w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition-colors font-semibold"> Update Page Content </button>
      </form>
     </div>
    </div><!-- Backup & Export -->
    <div class="bg-white rounded-xl shadow-lg p-6 mt-8">
     <h3 class="text-xl font-semibold text-gray-900 mb-4">Data Management</h3>
     <div class="grid grid-cols-1 md:grid-cols-3 gap-4"><button id="export-all-data-btn" class="bg-purple-600 text-white p-4 rounded-lg hover:bg-purple-700 transition-colors">
       <div class="text-2xl mb-2">
        📊
       </div>
       <div class="font-semibold">
        Export All Data
       </div></button> <button id="backup-settings-btn" class="bg-orange-600 text-white p-4 rounded-lg hover:bg-orange-700 transition-colors">
       <div class="text-2xl mb-2">
        💾
       </div>
       <div class="font-semibold">
        Backup Settings
       </div></button> <button id="reset-demo-data-btn" class="bg-red-600 text-white p-4 rounded-lg hover:bg-red-700 transition-colors">
       <div class="text-2xl mb-2">
        🔄
       </div>
       <div class="font-semibold">
        Reset Demo Data
       </div></button>
     </div>
    </div>
   </section><!-- Add/Edit Plan Modal -->
   <div id="plan-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
    <div class="flex items-center justify-center min-h-screen p-4">
     <div class="bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-screen overflow-y-auto">
      <div class="p-6 border-b border-gray-200">
       <div class="flex justify-between items-center">
        <h3 id="plan-modal-title" class="text-2xl font-bold text-gray-900">Add New Plan</h3><button id="close-plan-modal" class="text-gray-400 hover:text-gray-600">
         <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
         </svg></button>
       </div>
      </div>
      <form id="plan-form" class="p-6 space-y-6">
       <div class="grid grid-cols-1 md:grid-cols-2 gap-6"><!-- Basic Plan Info -->
        <div><label for="plan-company" class="block text-sm font-medium text-gray-700 mb-2">Company *</label> <select id="plan-company" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"> <option value="">Select Company</option> <option value="local">Sonipat Home Service</option> <option value="airtel">Airtel</option> <option value="jio">Jio</option> <option value="excitel">Excitel</option> <option value="bsnl">BSNL</option> <option value="other">Other</option> </select>
        </div>
        <div><label for="plan-name" class="block text-sm font-medium text-gray-700 mb-2">Plan Name *</label> <input type="text" id="plan-name" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
        </div>
        <div><label for="plan-speed" class="block text-sm font-medium text-gray-700 mb-2">Speed *</label> <input type="text" id="plan-speed" required placeholder="e.g., 100 Mbps" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
        </div>
        <div><label for="plan-data-limit" class="block text-sm font-medium text-gray-700 mb-2">Data Limit</label> <input type="text" id="plan-data-limit" placeholder="e.g., Unlimited" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
        </div>
       </div><!-- Locality Pricing -->
       <div>
        <h4 class="text-lg font-semibold text-gray-900 mb-4">Locality-wise Pricing (₹/month)</h4>
        <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
         <div><label for="price-kundli" class="block text-sm font-medium text-gray-700 mb-2">Kundli</label> <input type="number" id="price-kundli" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
         </div>
         <div><label for="price-rai" class="block text-sm font-medium text-gray-700 mb-2">Rai</label> <input type="number" id="price-rai" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
         </div>
         <div><label for="price-bahalgarh" class="block text-sm font-medium text-gray-700 mb-2">Bahalgarh</label> <input type="number" id="price-bahalgarh" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
         </div>
         <div><label for="price-murthal" class="block text-sm font-medium text-gray-700 mb-2">Murthal</label> <input type="number" id="price-murthal" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
         </div>
         <div><label for="price-sonipat" class="block text-sm font-medium text-gray-700 mb-2">Sonipat</label> <input type="number" id="price-sonipat" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
         </div>
         <div><label for="price-gannaur" class="block text-sm font-medium text-gray-700 mb-2">Gannaur</label> <input type="number" id="price-gannaur" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
         </div>
        </div>
       </div><!-- Add-ons -->
       <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
         <h4 class="text-lg font-semibold text-gray-900 mb-4">OTT Add-on</h4>
         <div class="space-y-3">
          <div><label for="ott-price" class="block text-sm font-medium text-gray-700 mb-2">OTT Price (₹/month)</label> <input type="number" id="ott-price" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
          </div>
          <div><label for="ott-description" class="block text-sm font-medium text-gray-700 mb-2">OTT Description</label> <input type="text" id="ott-description" placeholder="e.g., Netflix, Prime Video" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
          </div>
         </div>
        </div>
        <div>
         <h4 class="text-lg font-semibold text-gray-900 mb-4">IPTV Add-on</h4>
         <div class="space-y-3">
          <div><label for="iptv-price" class="block text-sm font-medium text-gray-700 mb-2">IPTV Price (₹/month)</label> <input type="number" id="iptv-price" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
          </div>
          <div><label for="iptv-description" class="block text-sm font-medium text-gray-700 mb-2">IPTV Description</label> <input type="text" id="iptv-description" placeholder="e.g., 200+ Channels" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
          </div>
         </div>
        </div>
       </div><!-- Features and Availability -->
       <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div><label for="plan-features" class="block text-sm font-medium text-gray-700 mb-2">Features (one per line)</label> <textarea id="plan-features" rows="4" placeholder="Free Router
24/7 Support
No Installation Fee" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
        </div>
        <div><label class="block text-sm font-medium text-gray-700 mb-2">Available Localities</label>
         <div class="space-y-2"><label class="flex items-center"> <input type="checkbox" class="locality-checkbox mr-2" value="kundli"> Kundli </label> <label class="flex items-center"> <input type="checkbox" class="locality-checkbox mr-2" value="rai"> Rai </label> <label class="flex items-center"> <input type="checkbox" class="locality-checkbox mr-2" value="bahalgarh"> Bahalgarh </label> <label class="flex items-center"> <input type="checkbox" class="locality-checkbox mr-2" value="murthal"> Murthal </label> <label class="flex items-center"> <input type="checkbox" class="locality-checkbox mr-2" value="sonipat"> Sonipat </label> <label class="flex items-center"> <input type="checkbox" class="locality-checkbox mr-2" value="gannaur"> Gannaur </label>
         </div>
        </div>
       </div><!-- Status -->
       <div><label class="flex items-center"> <input type="checkbox" id="plan-active" class="mr-2"> <span class="text-sm font-medium text-gray-700">Plan is Active</span> </label>
       </div><!-- Form Actions -->
       <div class="flex space-x-4 pt-6 border-t border-gray-200"><button type="button" id="cancel-plan-form" class="flex-1 bg-gray-500 text-white py-3 rounded-lg hover:bg-gray-600 transition-colors font-semibold"> Cancel </button> <button type="submit" id="save-plan-btn" class="flex-1 bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition-colors font-semibold"> Save Plan </button>
       </div>
      </form>
     </div>
    </div>
   </div>
  </main><!-- Success/Error Messages -->
  <div id="success-message" class="fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 hidden">
   <div class="flex items-center">
    <svg class="w-5 h-5 mr-2" fill="currentColor" viewbox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
    </svg><span id="success-text">Success!</span>
   </div>
  </div>
  <div id="error-message" class="fixed top-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 hidden">
   <div class="flex items-center">
    <svg class="w-5 h-5 mr-2" fill="currentColor" viewbox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
    </svg><span id="error-text">Error occurred!</span>
   </div>
  </div>
  <script>
        // Configuration and state
        const defaultConfig = {
            company_name: "ISP Admin Panel",
            company_tagline: "Manage Plans & Settings",
            contact_phone: "88160 14071",
            contact_email: "admin@sonipathomeservice.com",
            hero_title: "Choose Your Perfect Internet Plan",
            hero_description: "Experience lightning-fast internet with our reliable and affordable plans."
        };

        let allData = [];
        let currentEditingPlan = null;
        let currentTab = 'dashboard';

        // Data SDK handler
        const dataHandler = {
            onDataChanged(data) {
                allData = data;
                updateDashboardStats();
                loadPlansTable();
                loadOrdersTable();
            }
        };

        // Element SDK functions
        async function onConfigChange(config) {
            document.getElementById('company-name').textContent = config.company_name || defaultConfig.company_name;
            document.getElementById('company-tagline').textContent = config.company_tagline || defaultConfig.company_tagline;
            document.getElementById('contact-phone').textContent = `📞 ${config.contact_phone || defaultConfig.contact_phone}`;
            document.getElementById('contact-email').textContent = `✉️ ${config.contact_email || defaultConfig.contact_email}`;
            
            // Update settings form
            document.getElementById('settings-company-name').value = config.company_name || defaultConfig.company_name;
            document.getElementById('settings-company-tagline').value = config.company_tagline || defaultConfig.company_tagline;
            document.getElementById('settings-contact-phone').value = config.contact_phone || defaultConfig.contact_phone;
            document.getElementById('settings-contact-email').value = config.contact_email || defaultConfig.contact_email;
            document.getElementById('settings-hero-title').value = config.hero_title || defaultConfig.hero_title;
            document.getElementById('settings-hero-description').value = config.hero_description || defaultConfig.hero_description;
        }

        function mapToCapabilities(config) {
            return {
                recolorables: [
                    {
                        get: () => config.primary_color || "#3b82f6",
                        set: (value) => {
                            config.primary_color = value;
                            if (window.elementSdk) {
                                window.elementSdk.setConfig({ primary_color: value });
                            }
                        }
                    }
                ],
                borderables: [],
                fontEditable: undefined,
                fontSizeable: undefined
            };
        }

        function mapToEditPanelValues(config) {
            return new Map([
                ["company_name", config.company_name || defaultConfig.company_name],
                ["company_tagline", config.company_tagline || defaultConfig.company_tagline],
                ["contact_phone", config.contact_phone || defaultConfig.contact_phone],
                ["contact_email", config.contact_email || defaultConfig.contact_email],
                ["hero_title", config.hero_title || defaultConfig.hero_title],
                ["hero_description", config.hero_description || defaultConfig.hero_description]
            ]);
        }

        // Initialize SDKs
        async function initializeApp() {
            try {
                // Initialize Data SDK
                const dataResult = await window.dataSdk.init(dataHandler);
                if (!dataResult.isOk) {
                    console.error('Failed to initialize Data SDK');
                }

                // Initialize Element SDK
                if (window.elementSdk) {
                    await window.elementSdk.init({
                        defaultConfig,
                        onConfigChange,
                        mapToCapabilities,
                        mapToEditPanelValues
                    });
                }
            } catch (error) {
                console.error('Initialization error:', error);
            }
        }

        // Tab Management
        function setupTabNavigation() {
            const tabButtons = document.querySelectorAll('.admin-tab');
            const sections = document.querySelectorAll('.admin-section');

            tabButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const targetTab = this.getAttribute('data-tab');
                    
                    // Update active tab
                    tabButtons.forEach(btn => {
                        btn.classList.remove('tab-active');
                        btn.classList.add('tab-inactive');
                    });
                    this.classList.remove('tab-inactive');
                    this.classList.add('tab-active');
                    
                    // Show target section
                    sections.forEach(section => {
                        section.classList.add('hidden');
                    });
                    document.getElementById(targetTab + '-tab').classList.remove('hidden');
                    
                    currentTab = targetTab;
                    
                    // Load data for specific tabs
                    if (targetTab === 'plans') {
                        loadPlansTable();
                    } else if (targetTab === 'orders') {
                        loadOrdersTable();
                    }
                });
            });
        }

        // Dashboard Stats
        function updateDashboardStats() {
            const plans = allData.filter(item => item.type === 'plan');
            const orders = allData.filter(item => item.type === 'order' || item.customer_name);
            const activePlans = plans.filter(plan => plan.is_active);

            document.getElementById('total-plans').textContent = plans.length;
            document.getElementById('total-orders').textContent = orders.length;
            document.getElementById('active-plans').textContent = activePlans.length;
        }

        // Plans Management
        function loadPlansTable() {
            const plans = allData.filter(item => item.type === 'plan');
            const tableBody = document.getElementById('plans-table-body');
            const loading = document.getElementById('plans-loading');
            const empty = document.getElementById('plans-empty');

            loading.classList.add('hidden');
            
            if (plans.length === 0) {
                tableBody.innerHTML = '';
                empty.classList.remove('hidden');
                return;
            }

            empty.classList.add('hidden');
            
            tableBody.innerHTML = plans.map(plan => `
                <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4">
                        <div class="font-medium text-gray-900">${plan.plan_name}</div>
                        <div class="text-sm text-gray-500">${plan.speed} • ${plan.data_limit || 'Unlimited'}</div>
                    </td>
                    <td class="px-6 py-4">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${getCompanyBadgeClass(plan.company)}">
                            ${getCompanyDisplayName(plan.company)}
                        </span>
                    </td>
                    <td class="px-6 py-4">
                        <div class="text-sm text-gray-900">${formatLocalities(plan.localities)}</div>
                    </td>
                    <td class="px-6 py-4">
                        <div class="text-sm text-gray-900">₹${getMinPrice(plan)} - ₹${getMaxPrice(plan)}</div>
                    </td>
                    <td class="px-6 py-4">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${plan.is_active ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                            ${plan.is_active ? 'Active' : 'Inactive'}
                        </span>
                    </td>
                    <td class="px-6 py-4 text-sm font-medium">
                        <button onclick="editPlan('${plan.__backendId}')" class="text-blue-600 hover:text-blue-900 mr-3">Edit</button>
                        <button onclick="togglePlanStatus('${plan.__backendId}')" class="text-${plan.is_active ? 'red' : 'green'}-600 hover:text-${plan.is_active ? 'red' : 'green'}-900 mr-3">
                            ${plan.is_active ? 'Deactivate' : 'Activate'}
                        </button>
                        <button onclick="deletePlan('${plan.__backendId}')" class="text-red-600 hover:text-red-900">Delete</button>
                    </td>
                </tr>
            `).join('');
        }

        // Orders Management
        function loadOrdersTable() {
            const orders = allData.filter(item => item.type === 'order' || item.customer_name);
            const tableBody = document.getElementById('orders-table-body');
            const loading = document.getElementById('orders-loading');
            const empty = document.getElementById('orders-empty');

            loading.classList.add('hidden');
            
            if (orders.length === 0) {
                tableBody.innerHTML = '';
                empty.classList.remove('hidden');
                return;
            }

            empty.classList.add('hidden');
            
            tableBody.innerHTML = orders.map(order => `
                <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4">
                        <div class="font-mono text-sm text-gray-900">${order.order_id}</div>
                    </td>
                    <td class="px-6 py-4">
                        <div class="font-medium text-gray-900">${order.customer_name}</div>
                        <div class="text-sm text-gray-500">${order.address}</div>
                    </td>
                    <td class="px-6 py-4">
                        <div class="text-sm text-gray-900">${order.selected_plan}</div>
                    </td>
                    <td class="px-6 py-4">
                        <div class="font-medium text-gray-900">₹${order.plan_price}</div>
                    </td>
                    <td class="px-6 py-4">
                        <div class="text-sm text-gray-900">${formatDate(order.order_date)}</div>
                    </td>
                    <td class="px-6 py-4">
                        <div class="text-sm text-gray-900">${order.mobile}</div>
                        <div class="text-sm text-gray-500">${order.email}</div>
                    </td>
                </tr>
            `).join('');
        }

        // Plan Modal Management
        function setupPlanModal() {
            const modal = document.getElementById('plan-modal');
            const form = document.getElementById('plan-form');
            const addBtn = document.getElementById('add-new-plan-btn');
            const closeBtn = document.getElementById('close-plan-modal');
            const cancelBtn = document.getElementById('cancel-plan-form');

            addBtn.addEventListener('click', () => openPlanModal());
            closeBtn.addEventListener('click', () => closePlanModal());
            cancelBtn.addEventListener('click', () => closePlanModal());

            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                await savePlan();
            });

            // Close modal on backdrop click
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    closePlanModal();
                }
            });
        }

        function openPlanModal(planId = null) {
            const modal = document.getElementById('plan-modal');
            const title = document.getElementById('plan-modal-title');
            const form = document.getElementById('plan-form');

            if (planId) {
                const plan = allData.find(item => item.__backendId === planId);
                if (plan) {
                    title.textContent = 'Edit Plan';
                    populatePlanForm(plan);
                    currentEditingPlan = plan;
                }
            } else {
                title.textContent = 'Add New Plan';
                form.reset();
                currentEditingPlan = null;
            }

            modal.classList.remove('hidden');
        }

        function closePlanModal() {
            document.getElementById('plan-modal').classList.add('hidden');
            currentEditingPlan = null;
        }

        function populatePlanForm(plan) {
            document.getElementById('plan-company').value = plan.company || '';
            document.getElementById('plan-name').value = plan.plan_name || '';
            document.getElementById('plan-speed').value = plan.speed || '';
            document.getElementById('plan-data-limit').value = plan.data_limit || '';
            document.getElementById('price-kundli').value = plan.base_price_kundli || '';
            document.getElementById('price-rai').value = plan.base_price_rai || '';
            document.getElementById('price-bahalgarh').value = plan.base_price_bahalgarh || '';
            document.getElementById('price-murthal').value = plan.base_price_murthal || '';
            document.getElementById('price-sonipat').value = plan.base_price_sonipat || '';
            document.getElementById('price-gannaur').value = plan.base_price_gannaur || '';
            document.getElementById('ott-price').value = plan.ott_price || '';
            document.getElementById('ott-description').value = plan.ott_description || '';
            document.getElementById('iptv-price').value = plan.iptv_price || '';
            document.getElementById('iptv-description').value = plan.iptv_description || '';
            document.getElementById('plan-features').value = plan.features || '';
            document.getElementById('plan-active').checked = plan.is_active || false;

            // Set locality checkboxes
            const localities = plan.localities ? plan.localities.split(',') : [];
            document.querySelectorAll('.locality-checkbox').forEach(checkbox => {
                checkbox.checked = localities.includes(checkbox.value);
            });
        }

        async function savePlan() {
            const saveBtn = document.getElementById('save-plan-btn');
            saveBtn.disabled = true;
            saveBtn.textContent = 'Saving...';

            try {
                const formData = new FormData(document.getElementById('plan-form'));
                const selectedLocalities = Array.from(document.querySelectorAll('.locality-checkbox:checked'))
                    .map(cb => cb.value);

                const planData = {
                    type: 'plan',
                    plan_id: currentEditingPlan ? currentEditingPlan.plan_id : 'plan_' + Date.now(),
                    company: document.getElementById('plan-company').value,
                    plan_name: document.getElementById('plan-name').value,
                    speed: document.getElementById('plan-speed').value,
                    data_limit: document.getElementById('plan-data-limit').value,
                    features: document.getElementById('plan-features').value,
                    base_price_kundli: parseInt(document.getElementById('price-kundli').value) || 0,
                    base_price_rai: parseInt(document.getElementById('price-rai').value) || 0,
                    base_price_bahalgarh: parseInt(document.getElementById('price-bahalgarh').value) || 0,
                    base_price_murthal: parseInt(document.getElementById('price-murthal').value) || 0,
                    base_price_sonipat: parseInt(document.getElementById('price-sonipat').value) || 0,
                    base_price_gannaur: parseInt(document.getElementById('price-gannaur').value) || 0,
                    ott_price: parseInt(document.getElementById('ott-price').value) || 0,
                    iptv_price: parseInt(document.getElementById('iptv-price').value) || 0,
                    ott_description: document.getElementById('ott-description').value,
                    iptv_description: document.getElementById('iptv-description').value,
                    localities: selectedLocalities.join(','),
                    is_active: document.getElementById('plan-active').checked,
                    created_at: currentEditingPlan ? currentEditingPlan.created_at : new Date().toISOString(),
                    updated_at: new Date().toISOString()
                };

                let result;
                if (currentEditingPlan) {
                    planData.__backendId = currentEditingPlan.__backendId;
                    result = await window.dataSdk.update(planData);
                } else {
                    result = await window.dataSdk.create(planData);
                }

                if (result.isOk) {
                    showMessage('Plan saved successfully!', 'success');
                    closePlanModal();
                } else {
                    showMessage('Failed to save plan. Please try again.', 'error');
                }
            } catch (error) {
                showMessage('An error occurred while saving the plan.', 'error');
                console.error('Save plan error:', error);
            }

            saveBtn.disabled = false;
            saveBtn.textContent = 'Save Plan';
        }

        // Plan Actions
        function editPlan(planId) {
            openPlanModal(planId);
        }

        async function togglePlanStatus(planId) {
            const plan = allData.find(item => item.__backendId === planId);
            if (!plan) return;

            try {
                const updatedPlan = { ...plan, is_active: !plan.is_active, updated_at: new Date().toISOString() };
                const result = await window.dataSdk.update(updatedPlan);

                if (result.isOk) {
                    showMessage(`Plan ${updatedPlan.is_active ? 'activated' : 'deactivated'} successfully!`, 'success');
                } else {
                    showMessage('Failed to update plan status.', 'error');
                }
            } catch (error) {
                showMessage('An error occurred while updating the plan.', 'error');
                console.error('Toggle plan status error:', error);
            }
        }

        async function deletePlan(planId) {
            const plan = allData.find(item => item.__backendId === planId);
            if (!plan) return;

            // Simple confirmation using a temporary button approach
            const confirmDelete = document.createElement('div');
            confirmDelete.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center';
            confirmDelete.innerHTML = `
                <div class="bg-white rounded-lg p-6 max-w-md mx-4">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Delete Plan</h3>
                    <p class="text-gray-600 mb-6">Are you sure you want to delete "${plan.plan_name}"? This action cannot be undone.</p>
                    <div class="flex space-x-4">
                        <button id="cancel-delete" class="flex-1 bg-gray-500 text-white py-2 px-4 rounded-lg hover:bg-gray-600">Cancel</button>
                        <button id="confirm-delete" class="flex-1 bg-red-600 text-white py-2 px-4 rounded-lg hover:bg-red-700">Delete</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(confirmDelete);

            document.getElementById('cancel-delete').addEventListener('click', () => {
                document.body.removeChild(confirmDelete);
            });

            document.getElementById('confirm-delete').addEventListener('click', async () => {
                try {
                    const result = await window.dataSdk.delete(plan);
                    if (result.isOk) {
                        showMessage('Plan deleted successfully!', 'success');
                    } else {
                        showMessage('Failed to delete plan.', 'error');
                    }
                } catch (error) {
                    showMessage('An error occurred while deleting the plan.', 'error');
                    console.error('Delete plan error:', error);
                }
                document.body.removeChild(confirmDelete);
            });
        }

        // Settings Management
        function setupSettings() {
            const companyForm = document.getElementById('company-settings-form');
            const pageForm = document.getElementById('page-content-form');

            companyForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const config = {
                    company_name: document.getElementById('settings-company-name').value,
                    company_tagline: document.getElementById('settings-company-tagline').value,
                    contact_phone: document.getElementById('settings-contact-phone').value,
                    contact_email: document.getElementById('settings-contact-email').value
                };

                if (window.elementSdk) {
                    await window.elementSdk.setConfig(config);
                    showMessage('Company information updated successfully!', 'success');
                }
            });

            pageForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const config = {
                    hero_title: document.getElementById('settings-hero-title').value,
                    hero_description: document.getElementById('settings-hero-description').value
                };

                if (window.elementSdk) {
                    await window.elementSdk.setConfig(config);
                    showMessage('Page content updated successfully!', 'success');
                }
            });
        }

        // Quick Actions
        function setupQuickActions() {
            const quickActionBtns = document.querySelectorAll('.quick-action-btn');
            
            quickActionBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const action = this.getAttribute('data-action');
                    
                    switch(action) {
                        case 'add-plan':
                            // Switch to plans tab and open modal
                            document.querySelector('[data-tab="plans"]').click();
                            setTimeout(() => openPlanModal(), 100);
                            break;
                        case 'view-orders':
                            document.querySelector('[data-tab="orders"]').click();
                            break;
                        case 'update-settings':
                            document.querySelector('[data-tab="settings"]').click();
                            break;
                    }
                });
            });
        }

        // Data Export
        function setupDataExport() {
            document.getElementById('export-orders-btn').addEventListener('click', exportOrders);
            document.getElementById('export-all-data-btn').addEventListener('click', exportAllData);
            document.getElementById('backup-settings-btn').addEventListener('click', backupSettings);
            document.getElementById('reset-demo-data-btn').addEventListener('click', resetDemoData);
        }

        function exportOrders() {
            const orders = allData.filter(item => item.type === 'order' || item.customer_name);
            const csv = convertToCSV(orders, ['order_id', 'customer_name', 'selected_plan', 'plan_price', 'mobile', 'email', 'address', 'order_date']);
            downloadCSV(csv, 'orders.csv');
            showMessage('Orders exported successfully!', 'success');
        }

        function exportAllData() {
            const csv = convertToCSV(allData);
            downloadCSV(csv, 'all_data.csv');
            showMessage('All data exported successfully!', 'success');
        }

        function backupSettings() {
            if (window.elementSdk && window.elementSdk.config) {
                const settings = JSON.stringify(window.elementSdk.config, null, 2);
                const blob = new Blob([settings], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'settings_backup.json';
                a.click();
                URL.revokeObjectURL(url);
                showMessage('Settings backed up successfully!', 'success');
            }
        }

        async function resetDemoData() {
            // Create confirmation dialog
            const confirmReset = document.createElement('div');
            confirmReset.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center';
            confirmReset.innerHTML = `
                <div class="bg-white rounded-lg p-6 max-w-md mx-4">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Reset Demo Data</h3>
                    <p class="text-gray-600 mb-6">This will add sample plans to help you get started. Existing data will not be deleted.</p>
                    <div class="flex space-x-4">
                        <button id="cancel-reset" class="flex-1 bg-gray-500 text-white py-2 px-4 rounded-lg hover:bg-gray-600">Cancel</button>
                        <button id="confirm-reset" class="flex-1 bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700">Add Demo Data</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(confirmReset);

            document.getElementById('cancel-reset').addEventListener('click', () => {
                document.body.removeChild(confirmReset);
            });

            document.getElementById('confirm-reset').addEventListener('click', async () => {
                await addDemoPlans();
                document.body.removeChild(confirmReset);
            });
        }

        async function addDemoPlans() {
            const demoPlans = [
                {
                    type: 'plan',
                    plan_id: 'demo_basic_fiber',
                    company: 'local',
                    plan_name: 'Basic Fiber',
                    speed: '50 Mbps',
                    data_limit: 'Unlimited',
                    features: 'Unlimited Data\nLocal Support\n24/7 Customer Care',
                    base_price_kundli: 599,
                    base_price_rai: 449,
                    base_price_bahalgarh: 549,
                    base_price_murthal: 499,
                    base_price_sonipat: 499,
                    base_price_gannaur: 479,
                    ott_price: 199,
                    iptv_price: 149,
                    ott_description: 'Netflix, Prime Video',
                    iptv_description: '150+ Channels',
                    localities: 'kundli,rai,bahalgarh,murthal,sonipat,gannaur',
                    is_active: true,
                    created_at: new Date().toISOString(),
                    updated_at: new Date().toISOString()
                },
                {
                    type: 'plan',
                    plan_id: 'demo_airtel_xstream',
                    company: 'airtel',
                    plan_name: 'Xstream Fiber',
                    speed: '100 Mbps',
                    data_limit: 'Unlimited',
                    features: 'Unlimited Data\nFree Router\nAirtel Thanks Benefits',
                    base_price_kundli: 899,
                    base_price_rai: 0,
                    base_price_bahalgarh: 0,
                    base_price_murthal: 849,
                    base_price_sonipat: 799,
                    base_price_gannaur: 0,
                    ott_price: 299,
                    iptv_price: 199,
                    ott_description: 'Disney+, Prime Video',
                    iptv_description: '200+ Channels',
                    localities: 'kundli,sonipat,murthal',
                    is_active: true,
                    created_at: new Date().toISOString(),
                    updated_at: new Date().toISOString()
                }
            ];

            try {
                for (const plan of demoPlans) {
                    await window.dataSdk.create(plan);
                }
                showMessage('Demo plans added successfully!', 'success');
            } catch (error) {
                showMessage('Failed to add demo plans.', 'error');
                console.error('Add demo plans error:', error);
            }
        }

        // Utility Functions
        function getCompanyBadgeClass(company) {
            const classes = {
                'local': 'bg-green-100 text-green-800',
                'airtel': 'bg-red-100 text-red-800',
                'jio': 'bg-blue-100 text-blue-800',
                'excitel': 'bg-purple-100 text-purple-800',
                'bsnl': 'bg-orange-100 text-orange-800'
            };
            return classes[company] || 'bg-gray-100 text-gray-800';
        }

        function getCompanyDisplayName(company) {
            const names = {
                'local': 'Sonipat Home Service',
                'airtel': 'Airtel',
                'jio': 'Jio',
                'excitel': 'Excitel',
                'bsnl': 'BSNL'
            };
            return names[company] || company;
        }

        function formatLocalities(localities) {
            if (!localities) return 'None';
            return localities.split(',').map(loc => 
                loc.charAt(0).toUpperCase() + loc.slice(1)
            ).join(', ');
        }

        function getMinPrice(plan) {
            const prices = [
                plan.base_price_kundli,
                plan.base_price_rai,
                plan.base_price_bahalgarh,
                plan.base_price_murthal,
                plan.base_price_sonipat,
                plan.base_price_gannaur
            ].filter(price => price > 0);
            return prices.length > 0 ? Math.min(...prices) : 0;
        }

        function getMaxPrice(plan) {
            const prices = [
                plan.base_price_kundli,
                plan.base_price_rai,
                plan.base_price_bahalgarh,
                plan.base_price_murthal,
                plan.base_price_sonipat,
                plan.base_price_gannaur
            ].filter(price => price > 0);
            return prices.length > 0 ? Math.max(...prices) : 0;
        }

        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            const date = new Date(dateString);
            return date.toLocaleDateString() + ' ' + date.toLocaleTimeString();
        }

        function convertToCSV(data, columns = null) {
            if (data.length === 0) return '';
            
            const headers = columns || Object.keys(data[0]);
            const csvContent = [
                headers.join(','),
                ...data.map(row => 
                    headers.map(header => {
                        const value = row[header] || '';
                        return `"${String(value).replace(/"/g, '""')}"`;
                    }).join(',')
                )
            ].join('\n');
            
            return csvContent;
        }

        function downloadCSV(csv, filename) {
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
        }

        function showMessage(text, type = 'success') {
            const messageEl = document.getElementById(type + '-message');
            const textEl = document.getElementById(type + '-text');
            
            textEl.textContent = text;
            messageEl.classList.remove('hidden');
            
            setTimeout(() => {
                messageEl.classList.add('hidden');
            }, 3000);
        }

        // Initialize everything when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setupTabNavigation();
            setupPlanModal();
            setupSettings();
            setupQuickActions();
            setupDataExport();
        });
    </script><!-- Footer -->
  <footer class="bg-gray-900 text-white py-8 mt-12">
   <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
     <div>
      <h4 class="text-lg font-semibold mb-4">ISP Admin Panel</h4>
      <p class="text-gray-400">Comprehensive management system for internet service providers. Manage plans, view orders, and update settings all in one place.</p>
     </div>
     <div>
      <h4 class="text-lg font-semibold mb-4">Features</h4>
      <ul class="space-y-2 text-gray-400">
       <li>• Plan Management</li>
       <li>• Order Tracking</li>
       <li>• Data Export</li>
       <li>• Settings Control</li>
      </ul>
     </div>
     <div>
      <h4 class="text-lg font-semibold mb-4">Support</h4>
      <div class="space-y-2 text-gray-400">
       <p>📞 88160 14071</p>
       <p>✉️ admin@sonipathomeservice.com</p>
       <p>🕒 24/7 Admin Support</p>
      </div>
     </div>
    </div>
    <div class="border-t border-gray-800 mt-8 pt-8 text-center text-gray-400">
     <p>© 2024 ISP Admin Panel. All rights reserved.</p>
    </div>
   </div>
  </footer>
  <div class="plan-card bg-white rounded-xl shadow-lg p-6 border-2 border-green-500 hover:border-green-600 transition-all relative" data-company="local" data-localities="kundli,rai,bahalgarh,murthal,sonipat,gannaur">
   <div class="absolute -top-3 left-1/2 transform -translate-x-1/2"><span class="bg-green-500 text-white px-4 py-1 rounded-full text-sm font-semibold">⭐ Top Rated</span>
   </div>
   <div class="flex items-center justify-between mb-4"><span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-semibold">Sonipat Home Service</span>
    <div class="w-8 h-8 bg-green-600 rounded-full flex items-center justify-center"><span class="text-white text-xs font-bold">SH</span>
    </div>
   </div>
   <div class="text-center mb-6">
    <h3 class="text-xl font-bold text-gray-900 mb-2">Basic Fiber</h3>
    <div class="mb-3"><select class="duration-select bg-gray-50 border border-gray-300 rounded-lg px-3 py-2 text-sm font-medium" data-base-price-kundli="599" data-base-price-rai="449" data-base-price-bahalgarh="549" data-base-price-murthal="499" data-base-price-sonipat="499" data-base-price-gannaur="479"> <option value="3" data-discount="0">3 Months - ₹499/month</option> <option value="6" data-discount="5">6 Months - ₹474/month (5% off)</option> <option value="12" data-discount="10">12 Months - ₹449/month (10% off)</option> </select>
    </div>
    <div class="text-3xl font-bold text-green-600 mb-2 plan-price">
     ₹499
    </div>
    <p class="text-gray-600">per month</p>
   </div>
   <ul class="space-y-2 mb-4">
    <li class="flex items-center text-gray-700 text-sm"><span class="text-green-500 mr-2">✓</span> 50 Mbps Speed</li>
    <li class="flex items-center text-gray-700 text-sm"><span class="text-green-500 mr-2">✓</span> Unlimited Data</li>
    <li class="flex items-center text-gray-700 text-sm"><span class="text-green-500 mr-2">✓</span> Local Support</li>
   </ul>
   <div class="mb-4"><label class="flex items-center text-sm"> <input type="checkbox" class="ott-checkbox mr-2" data-price="199"> <span>+ OTT Pack (Netflix, Prime) - ₹199/month</span> </label> <label class="flex items-center text-sm mt-2"> <input type="checkbox" class="iptv-checkbox mr-2" data-price="149"> <span>+ IPTV Pack (150+ Channels) - ₹149/month</span> </label>
   </div>
   <div class="text-center mb-4"><span class="total-price text-lg font-bold text-gray-900">Total: ₹499/month</span>
   </div><button class="add-to-cart-btn w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition-colors font-semibold" data-company="Local Company" data-plan="Basic Fiber" data-base-price="499"> Add to Cart </button>
  </div><!-- Airtel Plans -->
  <div class="plan-card bg-white rounded-xl shadow-lg p-6 border-2 border-red-200 hover:border-red-500 transition-all" data-company="airtel" data-localities="kundli,sonipat,murthal">
   <div class="flex items-center justify-between mb-4"><span class="bg-red-100 text-red-800 px-3 py-1 rounded-full text-sm font-semibold">Airtel</span>
    <div class="w-8 h-8 bg-red-600 rounded-full flex items-center justify-center"><span class="text-white text-xs font-bold">A</span>
    </div>
   </div>
   <div class="text-center mb-6">
    <h3 class="text-xl font-bold text-gray-900 mb-2">Xstream Fiber</h3>
    <div class="mb-3"><select class="duration-select bg-gray-50 border border-gray-300 rounded-lg px-3 py-2 text-sm font-medium" data-base-price-kundli="899" data-base-price-sonipat="799" data-base-price-murthal="849"> <option value="3" data-discount="0">3 Months - ₹799/month</option> <option value="6" data-discount="5">6 Months - ₹759/month (5% off)</option> <option value="12" data-discount="10">12 Months - ₹719/month (10% off)</option> </select>
    </div>
    <div class="text-3xl font-bold text-red-600 mb-2 plan-price">
     ₹799
    </div>
    <p class="text-gray-600">per month</p>
   </div>
   <ul class="space-y-2 mb-4">
    <li class="flex items-center text-gray-700 text-sm"><span class="text-green-500 mr-2">✓</span> 100 Mbps Speed</li>
    <li class="flex items-center text-gray-700 text-sm"><span class="text-green-500 mr-2">✓</span> Unlimited Data</li>
    <li class="flex items-center text-gray-700 text-sm"><span class="text-green-500 mr-2">✓</span> Free Router</li>
   </ul>
   <div class="mb-4"><label class="flex items-center text-sm"> <input type="checkbox" class="ott-checkbox mr-2" data-price="299"> <span>+ Airtel Xstream (Disney+, Prime) - ₹299/month</span> </label> <label class="flex items-center text-sm mt-2"> <input type="checkbox" class="iptv-checkbox mr-2" data-price="199"> <span>+ DTH Pack (200+ Channels) - ₹199/month</span> </label>
   </div>
   <div class="text-center mb-4"><span class="total-price text-lg font-bold text-gray-900">Total: ₹799/month</span>
   </div><button class="add-to-cart-btn w-full bg-red-600 text-white py-3 rounded-lg hover:bg-red-700 transition-colors font-semibold" data-company="Airtel" data-plan="Xstream Fiber" data-base-price="799"> Add to Cart </button>
  </div><!-- Jio Plans -->
  <div class="plan-card bg-white rounded-xl shadow-lg p-6 border-2 border-blue-500 hover:border-blue-600 transition-all relative" data-company="jio" data-localities="kundli,sonipat,bahalgarh,murthal">
   <div class="absolute -top-3 left-1/2 transform -translate-x-1/2"><span class="bg-blue-500 text-white px-4 py-1 rounded-full text-sm font-semibold">Most Popular</span>
   </div>
   <div class="flex items-center justify-between mb-4"><span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-semibold">Jio</span>
    <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center"><span class="text-white text-xs font-bold">J</span>
    </div>
   </div>
   <div class="text-center mb-6">
    <h3 class="text-xl font-bold text-gray-900 mb-2">JioFiber</h3>
    <div class="mb-3"><select class="duration-select bg-gray-50 border border-gray-300 rounded-lg px-3 py-2 text-sm font-medium" data-base-price-kundli="799" data-base-price-sonipat="699" data-base-price-bahalgarh="749" data-base-price-murthal="729"> <option value="3" data-discount="0">3 Months - ₹699/month</option> <option value="6" data-discount="5">6 Months - ₹664/month (5% off)</option> <option value="12" data-discount="10">12 Months - ₹629/month (10% off)</option> </select>
    </div>
    <div class="text-3xl font-bold text-blue-600 mb-2 plan-price">
     ₹699
    </div>
    <p class="text-gray-600">per month</p>
   </div>
   <ul class="space-y-2 mb-4">
    <li class="flex items-center text-gray-700 text-sm"><span class="text-green-500 mr-2">✓</span> 100 Mbps Speed</li>
    <li class="flex items-center text-gray-700 text-sm"><span class="text-green-500 mr-2">✓</span> Unlimited Data</li>
    <li class="flex items-center text-gray-700 text-sm"><span class="text-green-500 mr-2">✓</span> Free JioTV</li>
   </ul>
   <div class="mb-4"><label class="flex items-center text-sm"> <input type="checkbox" class="ott-checkbox mr-2" data-price="249"> <span>+ JioCinema Premium - ₹249/month</span> </label> <label class="flex items-center text-sm mt-2"> <input type="checkbox" class="iptv-checkbox mr-2" data-price="0"> <span>+ JioTV (Free with plan)</span> </label>
   </div>
   <div class="text-center mb-4"><span class="total-price text-lg font-bold text-gray-900">Total: ₹699/month</span>
   </div><button class="add-to-cart-btn w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition-colors font-semibold" data-company="Jio" data-plan="JioFiber" data-base-price="699"> Add to Cart </button>
  </div><!-- Excitel Plans -->
  <div class="plan-card bg-white rounded-xl shadow-lg p-6 border-2 border-purple-200 hover:border-purple-500 transition-all" data-company="excitel" data-localities="kundli,sonipat">
   <div class="flex items-center justify-between mb-4"><span class="bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-sm font-semibold">Excitel</span>
    <div class="w-8 h-8 bg-purple-600 rounded-full flex items-center justify-center"><span class="text-white text-xs font-bold">E</span>
    </div>
   </div>
   <div class="text-center mb-6">
    <h3 class="text-xl font-bold text-gray-900 mb-2">Fiber Basic</h3>
    <div class="mb-3"><select class="duration-select bg-gray-50 border border-gray-300 rounded-lg px-3 py-2 text-sm font-medium" data-base-price-kundli="449" data-base-price-sonipat="399"> <option value="3" data-discount="0">3 Months - ₹399/month</option> <option value="6" data-discount="5">6 Months - ₹379/month (5% off)</option> <option value="12" data-discount="10">12 Months - ₹359/month (10% off)</option> </select>
    </div>
    <div class="text-3xl font-bold text-purple-600 mb-2 plan-price">
     ₹399
    </div>
    <p class="text-gray-600">per month</p>
   </div>
   <ul class="space-y-2 mb-4">
    <li class="flex items-center text-gray-700 text-sm"><span class="text-green-500 mr-2">✓</span> 50 Mbps Speed</li>
    <li class="flex items-center text-gray-700 text-sm"><span class="text-green-500 mr-2">✓</span> Unlimited Data</li>
    <li class="flex items-center text-gray-700 text-sm"><span class="text-green-500 mr-2">✓</span> No Installation Fee</li>
   </ul>
   <div class="mb-4"><label class="flex items-center text-sm"> <input type="checkbox" class="ott-checkbox mr-2" data-price="199"> <span>+ OTT Bundle (Netflix, Prime) - ₹199/month</span> </label> <label class="flex items-center text-sm mt-2"> <input type="checkbox" class="iptv-checkbox mr-2" data-price="129"> <span>+ IPTV Pack (100+ Channels) - ₹129/month</span> </label>
   </div>
   <div class="text-center mb-4"><span class="total-price text-lg font-bold text-gray-900">Total: ₹399/month</span>
   </div><button class="add-to-cart-btn w-full bg-purple-600 text-white py-3 rounded-lg hover:bg-purple-700 transition-colors font-semibold" data-company="Excitel" data-plan="Fiber Basic" data-base-price="399"> Add to Cart </button>
  </div><!-- BSNL Plans -->
  <div class="plan-card bg-white rounded-xl shadow-lg p-6 border-2 border-orange-200 hover:border-orange-500 transition-all" data-company="bsnl" data-localities="rai,gannaur,bahalgarh">
   <div class="flex items-center justify-between mb-4"><span class="bg-orange-100 text-orange-800 px-3 py-1 rounded-full text-sm font-semibold">BSNL</span>
    <div class="w-8 h-8 bg-orange-600 rounded-full flex items-center justify-center"><span class="text-white text-xs font-bold">B</span>
    </div>
   </div>
   <div class="text-center mb-6">
    <h3 class="text-xl font-bold text-gray-900 mb-2">Bharat Fiber</h3>
    <div class="mb-3"><select class="duration-select bg-gray-50 border border-gray-300 rounded-lg px-3 py-2 text-sm font-medium" data-base-price-rai="399" data-base-price-gannaur="429" data-base-price-bahalgarh="449"> <option value="3" data-discount="0">3 Months - ₹449/month</option> <option value="6" data-discount="5">6 Months - ₹427/month (5% off)</option> <option value="12" data-discount="10">12 Months - ₹404/month (10% off)</option> </select>
    </div>
    <div class="text-3xl font-bold text-orange-600 mb-2 plan-price">
     ₹449
    </div>
    <p class="text-gray-600">per month</p>
   </div>
   <ul class="space-y-2 mb-4">
    <li class="flex items-center text-gray-700 text-sm"><span class="text-green-500 mr-2">✓</span> 30 Mbps Speed</li>
    <li class="flex items-center text-gray-700 text-sm"><span class="text-green-500 mr-2">✓</span> Unlimited Data</li>
    <li class="flex items-center text-gray-700 text-sm"><span class="text-green-500 mr-2">✓</span> Government Backed</li>
   </ul>
   <div class="mb-4"><label class="flex items-center text-sm"> <input type="checkbox" class="ott-checkbox mr-2" data-price="149"> <span>+ OTT Pack (SonyLiv, Zee5) - ₹149/month</span> </label> <label class="flex items-center text-sm mt-2"> <input type="checkbox" class="iptv-checkbox mr-2" data-price="99"> <span>+ DD+ Channels Pack - ₹99/month</span> </label>
   </div>
   <div class="text-center mb-4"><span class="total-price text-lg font-bold text-gray-900">Total: ₹449/month</span>
   </div><button class="add-to-cart-btn w-full bg-orange-600 text-white py-3 rounded-lg hover:bg-orange-700 transition-colors font-semibold" data-company="BSNL" data-plan="Bharat Fiber" data-base-price="449"> Add to Cart </button>
  </div><!-- Additional Plans for each company -->
  <div class="plan-card bg-white rounded-xl shadow-lg p-6 border-2 border-gray-200 hover:border-blue-500 transition-all" data-company="local" data-localities="kundli,sonipat,murthal">
   <div class="flex items-center justify-between mb-4"><span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-semibold">Sonipat Home Service</span>
    <div class="w-8 h-8 bg-green-600 rounded-full flex items-center justify-center"><span class="text-white text-xs font-bold">SH</span>
    </div>
   </div>
   <div class="text-center mb-6">
    <h3 class="text-xl font-bold text-gray-900 mb-2">Premium Fiber</h3>
    <div class="mb-3"><select class="duration-select bg-gray-50 border border-gray-300 rounded-lg px-3 py-2 text-sm font-medium" data-base-price-kundli="899" data-base-price-sonipat="799" data-base-price-murthal="849"> <option value="3" data-discount="0">3 Months - ₹799/month</option> <option value="6" data-discount="5">6 Months - ₹759/month (5% off)</option> <option value="12" data-discount="10">12 Months - ₹719/month (10% off)</option> </select>
    </div>
    <div class="text-3xl font-bold text-green-600 mb-2 plan-price">
     ₹799
    </div>
    <p class="text-gray-600">per month</p>
   </div>
   <ul class="space-y-2 mb-4">
    <li class="flex items-center text-gray-700 text-sm"><span class="text-green-500 mr-2">✓</span> 100 Mbps Speed</li>
    <li class="flex items-center text-gray-700 text-sm"><span class="text-green-500 mr-2">✓</span> Unlimited Data</li>
    <li class="flex items-center text-gray-700 text-sm"><span class="text-green-500 mr-2">✓</span> Free Router + Installation</li>
   </ul>
   <div class="mb-4"><label class="flex items-center text-sm"> <input type="checkbox" class="ott-checkbox mr-2" data-price="299"> <span>+ Premium OTT (All Apps) - ₹299/month</span> </label> <label class="flex items-center text-sm mt-2"> <input type="checkbox" class="iptv-checkbox mr-2" data-price="199"> <span>+ Premium IPTV (300+ Channels) - ₹199/month</span> </label>
   </div>
   <div class="text-center mb-4"><span class="total-price text-lg font-bold text-gray-900">Total: ₹799/month</span>
   </div><button class="add-to-cart-btn w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition-colors font-semibold" data-company="Local Company" data-plan="Premium Fiber" data-base-price="799"> Add to Cart </button>
  </div> <!-- Customer Details Form -->
  <section id="customer-form-section" class="hidden mb-12">
   <div class="max-w-2xl mx-auto bg-white rounded-xl shadow-lg p-8">
    <h3 class="text-2xl font-bold text-gray-900 mb-6 text-center">Customer Details</h3>
    <form id="customer-form" class="space-y-6">
     <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div><label for="customer-name" class="block text-sm font-medium text-gray-700 mb-2">Full Name *</label> <input type="text" id="customer-name" name="customer_name" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
      </div>
      <div><label for="mobile" class="block text-sm font-medium text-gray-700 mb-2">Mobile Number *</label> <input type="tel" id="mobile" name="mobile" required pattern="[0-9]{10}" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
      </div>
     </div>
     <div><label for="email" class="block text-sm font-medium text-gray-700 mb-2">Email Address *</label> <input type="email" id="email" name="email" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
     </div>
     <div><label for="address" class="block text-sm font-medium text-gray-700 mb-2">Complete Address *</label> <textarea id="address" name="address" required rows="3" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
     </div>
     <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div><label for="landmark" class="block text-sm font-medium text-gray-700 mb-2">Landmark</label> <input type="text" id="landmark" name="landmark" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
      </div>
      <div><label for="pincode" class="block text-sm font-medium text-gray-700 mb-2">Pincode *</label> <input type="text" id="pincode" name="pincode" required pattern="[0-9]{6}" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
      </div>
     </div>
     <div class="bg-gray-50 p-4 rounded-lg">
      <h4 class="font-semibold text-gray-900 mb-2">Selected Plan:</h4>
      <div class="flex justify-between items-center"><span id="selected-plan-name" class="text-lg font-medium text-blue-600"></span> <span id="selected-plan-price" class="text-xl font-bold text-gray-900"></span>
      </div>
     </div>
     <div class="flex space-x-4"><button type="button" id="back-to-plans" class="flex-1 bg-gray-500 text-white py-3 rounded-lg hover:bg-gray-600 transition-colors font-semibold"> Back to Plans </button> <button type="submit" id="proceed-payment" class="flex-1 bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition-colors font-semibold"> Proceed to Payment </button>
     </div>
    </form>
   </div>
  </section><!-- Payment Demo Section -->
  <section id="payment-section" class="hidden mb-12">
   <div class="max-w-2xl mx-auto bg-white rounded-xl shadow-lg p-8">
    <div class="text-center mb-6">
     <div class="w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center mx-auto mb-4">
      <svg class="w-8 h-8 text-white" fill="currentColor" viewbox="0 0 20 20"><path d="M4 4a2 2 0 00-2 2v1h16V6a2 2 0 00-2-2H4zM18 9H2v5a2 2 0 002 2h12a2 2 0 002-2V9zM4 13a1 1 0 011-1h1a1 1 0 110 2H5a1 1 0 01-1-1zm5-1a1 1 0 100 2h1a1 1 0 100-2H9z" />
      </svg>
     </div>
     <h3 class="text-2xl font-bold text-gray-900 mb-2">Payment Gateway - Demo</h3>
     <p class="text-gray-600">This is a sample payment interface. In a real application, this would integrate with Razorpay.</p>
    </div>
    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6">
     <div class="flex items-center">
      <svg class="w-5 h-5 text-yellow-600 mr-2" fill="currentColor" viewbox="0 0 20 20"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
      </svg><span class="text-yellow-800 font-medium">Demo Mode: No actual payment will be processed</span>
     </div>
    </div>
    <div class="space-y-4 mb-6">
     <div class="flex justify-between items-center p-4 bg-gray-50 rounded-lg"><span class="font-medium">Plan:</span> <span id="payment-plan-name" class="text-blue-600 font-semibold"></span>
     </div>
     <div class="flex justify-between items-center p-4 bg-gray-50 rounded-lg"><span class="font-medium">Customer:</span> <span id="payment-customer-name" class="font-semibold"></span>
     </div>
     <div class="flex justify-between items-center p-4 bg-gray-50 rounded-lg"><span class="font-medium">Amount:</span> <span id="payment-amount" class="text-2xl font-bold text-green-600"></span>
     </div>
    </div>
    <div class="flex space-x-4"><button type="button" id="back-to-form" class="flex-1 bg-gray-500 text-white py-3 rounded-lg hover:bg-gray-600 transition-colors font-semibold"> Back to Details </button> <button type="button" id="complete-payment" class="flex-1 bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition-colors font-semibold"> Complete Payment (Demo) </button>
    </div>
   </div>
  </section><!-- Success Section -->
  <section id="success-section" class="hidden mb-12">
   <div class="max-w-2xl mx-auto bg-white rounded-xl shadow-lg p-8 text-center">
    <div class="w-16 h-16 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-4">
     <svg class="w-8 h-8 text-white" fill="currentColor" viewbox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
     </svg>
    </div>
    <h3 class="text-2xl font-bold text-green-600 mb-4">Order Successful!</h3>
    <p class="text-gray-600 mb-6">Thank you for choosing our service. Your order has been placed successfully.</p>
    <div class="bg-gray-50 p-4 rounded-lg mb-6">
     <p class="text-sm text-gray-600 mb-2">Order ID:</p>
     <p id="order-id" class="font-mono text-lg font-semibold"></p>
    </div><button type="button" id="new-order" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors font-semibold"> Place New Order </button>
   </div>
  </section> <!-- Footer -->
  <footer class="bg-gray-900 text-white py-12">
   <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
     <div>
      <h4 class="text-lg font-semibold mb-4">Sonipat Home Service.com</h4>
      <p class="text-gray-400">Providing reliable high-speed internet and home services for residents of Sonipat and surrounding areas.</p>
     </div>
     <div>
      <h4 class="text-lg font-semibold mb-4">Quick Links</h4>
      <ul class="space-y-2 text-gray-400">
       <li><a href="#" class="hover:text-white transition-colors">Home</a></li>
       <li><a href="#" class="hover:text-white transition-colors">Plans</a></li>
       <li><a href="#" class="hover:text-white transition-colors">Support</a></li>
       <li><a href="#" class="hover:text-white transition-colors">Contact</a></li>
      </ul>
     </div>
     <div>
      <h4 class="text-lg font-semibold mb-4">Support</h4>
      <ul class="space-y-2 text-gray-400">
       <li><a href="#" class="hover:text-white transition-colors">Help Center</a></li>
       <li><a href="#" class="hover:text-white transition-colors">Installation</a></li>
       <li><a href="#" class="hover:text-white transition-colors">Technical Support</a></li>
       <li><a href="#" class="hover:text-white transition-colors">Billing</a></li>
      </ul>
     </div>
     <div>
      <h4 class="text-lg font-semibold mb-4">Contact Info</h4>
      <div class="space-y-2 text-gray-400">
       <p>📞 88160 14071</p>
       <p>✉️ care@sonipathomeservice.com</p>
       <p>📍 128/1, Sainipura, Sonipat</p>
      </div>
     </div>
    </div>
    <div class="border-t border-gray-800 mt-8 pt-8 text-center text-gray-400">
     <p>© 2024 Sonipat Home Service.com. All rights reserved.</p>
    </div>
   </div>
  </footer>
  <script>
        // Configuration and state
        const defaultConfig = {
            company_name: "Sonipat Home Service.com",
            company_tagline: "Premium Internet & Home Services",
            contact_phone: "88160 14071",
            contact_email: "care@sonipathomeservice.com"
        };

        let currentPlan = null;
        let currentPrice = 0;
        let cartCount = 0;
        let currentOrderData = null;
        let selectedLocality = null;

        // Locality names mapping
        const localityNames = {
            'kundli': 'Kundli',
            'rai': 'Rai',
            'bahalgarh': 'Bahalgarh',
            'murthal': 'Murthal',
            'sonipat': 'Sonipat',
            'gannaur': 'Gannaur'
        };

        // Data SDK handler
        const dataHandler = {
            onDataChanged(data) {
                // Update UI if needed - for this demo, we just store orders
                console.log('Orders stored:', data.length);
            }
        };

        // Element SDK functions
        async function onConfigChange(config) {
            document.getElementById('company-name').textContent = config.company_name || defaultConfig.company_name;
            document.getElementById('company-tagline').textContent = config.company_tagline || defaultConfig.company_tagline;
            document.getElementById('contact-phone').textContent = `📞 ${config.contact_phone || defaultConfig.contact_phone}`;
            document.getElementById('contact-email').textContent = `✉️ ${config.contact_email || defaultConfig.contact_email}`;
        }

        function mapToCapabilities(config) {
            return {
                recolorables: [
                    {
                        get: () => config.primary_color || "#2563eb",
                        set: (value) => {
                            config.primary_color = value;
                            if (window.elementSdk) {
                                window.elementSdk.setConfig({ primary_color: value });
                            }
                        }
                    }
                ],
                borderables: [],
                fontEditable: undefined,
                fontSizeable: undefined
            };
        }

        function mapToEditPanelValues(config) {
            return new Map([
                ["company_name", config.company_name || defaultConfig.company_name],
                ["company_tagline", config.company_tagline || defaultConfig.company_tagline],
                ["contact_phone", config.contact_phone || defaultConfig.contact_phone],
                ["contact_email", config.contact_email || defaultConfig.contact_email]
            ]);
        }

        // Initialize SDKs
        async function initializeApp() {
            try {
                // Initialize Data SDK
                const dataResult = await window.dataSdk.init(dataHandler);
                if (!dataResult.isOk) {
                    console.error('Failed to initialize Data SDK');
                }

                // Initialize Element SDK
                if (window.elementSdk) {
                    await window.elementSdk.init({
                        defaultConfig,
                        onConfigChange,
                        mapToCapabilities,
                        mapToEditPanelValues
                    });
                }
            } catch (error) {
                console.error('Initialization error:', error);
            }
        }

        // Locality selection functionality
        function setupLocalitySelection() {
            const localityButtons = document.querySelectorAll('.locality-btn');
            const localitySection = document.getElementById('locality-selection');
            const selectedLocalityDisplay = document.getElementById('selected-locality-display');
            const companyFilterSection = document.getElementById('company-filter-section');
            const plansSection = document.getElementById('plans-section');
            const currentLocalitySpan = document.getElementById('current-locality');
            const changeLocalityBtn = document.getElementById('change-locality');

            localityButtons.forEach(button => {
                button.addEventListener('click', function() {
                    selectedLocality = this.getAttribute('data-locality');
                    currentLocalitySpan.textContent = localityNames[selectedLocality];
                    
                    // Hide locality selection, show plans
                    localitySection.classList.add('hidden');
                    selectedLocalityDisplay.classList.remove('hidden');
                    companyFilterSection.classList.remove('hidden');
                    plansSection.classList.remove('hidden');
                    
                    // Filter plans by locality and update prices
                    filterPlansByLocality();
                    updatePricesForLocality();
                });
            });

            changeLocalityBtn.addEventListener('click', function() {
                selectedLocality = null;
                localitySection.classList.remove('hidden');
                selectedLocalityDisplay.classList.add('hidden');
                companyFilterSection.classList.add('hidden');
                plansSection.classList.add('hidden');
                
                // Reset company filter
                const filterButtons = document.querySelectorAll('.company-filter-btn');
                filterButtons.forEach(btn => {
                    btn.classList.remove('bg-blue-600', 'text-white');
                    btn.classList.add('bg-gray-200', 'text-gray-700');
                });
                filterButtons[0].classList.remove('bg-gray-200', 'text-gray-700');
                filterButtons[0].classList.add('bg-blue-600', 'text-white');
            });
        }

        function filterPlansByLocality() {
            const planCards = document.querySelectorAll('.plan-card');
            
            planCards.forEach(card => {
                const cardLocalities = card.getAttribute('data-localities');
                if (cardLocalities && cardLocalities.includes(selectedLocality)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        function updatePricesForLocality() {
            const planCards = document.querySelectorAll('.plan-card');
            
            planCards.forEach(card => {
                const durationSelect = card.querySelector('.duration-select');
                const planPriceElement = card.querySelector('.plan-price');
                
                if (durationSelect && selectedLocality) {
                    const localityPrice = durationSelect.getAttribute(`data-base-price-${selectedLocality}`);
                    if (localityPrice) {
                        // Update the base price for this locality
                        const newPrice = parseInt(localityPrice);
                        planPriceElement.textContent = `₹${newPrice}`;
                        
                        // Update duration options
                        const options = durationSelect.querySelectorAll('option');
                        options.forEach(option => {
                            const discount = parseInt(option.getAttribute('data-discount'));
                            const discountedPrice = Math.round(newPrice * (1 - discount / 100));
                            const duration = option.value;
                            let durationText = '';
                            if (duration === '3') durationText = '3 Months';
                            else if (duration === '6') durationText = '6 Months';
                            else if (duration === '12') durationText = '12 Months';
                            
                            if (discount > 0) {
                                option.textContent = `${durationText} - ₹${discountedPrice}/month (${discount}% off)`;
                            } else {
                                option.textContent = `${durationText} - ₹${discountedPrice}/month`;
                            }
                        });
                        
                        // Trigger price recalculation
                        const event = new Event('change');
                        durationSelect.dispatchEvent(event);
                    }
                }
            });
        }

        // Company filtering functionality
        function setupCompanyFiltering() {
            const filterButtons = document.querySelectorAll('.company-filter-btn');
            const planCards = document.querySelectorAll('.plan-card');
            
            filterButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const selectedCompany = this.getAttribute('data-company');
                    
                    // Update active filter button
                    filterButtons.forEach(btn => {
                        btn.classList.remove('bg-blue-600', 'text-white');
                        btn.classList.add('bg-gray-200', 'text-gray-700');
                    });
                    this.classList.remove('bg-gray-200', 'text-gray-700');
                    this.classList.add('bg-blue-600', 'text-white');
                    
                    // Filter plan cards by company AND locality
                    planCards.forEach(card => {
                        const cardLocalities = card.getAttribute('data-localities');
                        const cardCompany = card.getAttribute('data-company');
                        const isLocalityMatch = cardLocalities && cardLocalities.includes(selectedLocality);
                        const isCompanyMatch = selectedCompany === 'all' || cardCompany === selectedCompany;
                        
                        if (isLocalityMatch && isCompanyMatch) {
                            card.style.display = 'block';
                        } else {
                            card.style.display = 'none';
                        }
                    });
                });
            });
        }

        // Duration and price calculation
        function setupPriceCalculation() {
            const planCards = document.querySelectorAll('.plan-card');
            
            planCards.forEach(card => {
                const durationSelect = card.querySelector('.duration-select');
                const ottCheckbox = card.querySelector('.ott-checkbox');
                const iptvCheckbox = card.querySelector('.iptv-checkbox');
                const totalPriceElement = card.querySelector('.total-price');
                const planPriceElement = card.querySelector('.plan-price');
                const addToCartBtn = card.querySelector('.add-to-cart-btn');
                
                function updatePrice() {
                    // Get current base price (locality-specific or default)
                    let basePrice;
                    if (selectedLocality) {
                        const localityPrice = durationSelect.getAttribute(`data-base-price-${selectedLocality}`);
                        basePrice = localityPrice ? parseInt(localityPrice) : 499;
                    } else {
                        basePrice = 499; // Default fallback
                    }
                    
                    // Get current duration discount
                    const selectedOption = durationSelect.options[durationSelect.selectedIndex];
                    const discount = parseInt(selectedOption.getAttribute('data-discount'));
                    const duration = selectedOption.value;
                    
                    // Calculate discounted base price
                    const discountedPrice = Math.round(basePrice * (1 - discount / 100));
                    
                    // Update plan price display
                    planPriceElement.textContent = `₹${discountedPrice}`;
                    
                    let totalPrice = discountedPrice;
                    let selectedAddons = [];
                    let durationText = '';
                    
                    if (duration === '3') durationText = '3 Months';
                    else if (duration === '6') durationText = '6 Months';
                    else if (duration === '12') durationText = '12 Months';
                    
                    if (ottCheckbox && ottCheckbox.checked && !ottCheckbox.disabled) {
                        totalPrice += parseInt(ottCheckbox.getAttribute('data-price'));
                        selectedAddons.push('OTT Pack');
                    }
                    
                    if (iptvCheckbox && iptvCheckbox.checked && !iptvCheckbox.disabled) {
                        totalPrice += parseInt(iptvCheckbox.getAttribute('data-price'));
                        selectedAddons.push('IPTV Pack');
                    }
                    
                    totalPriceElement.textContent = `Total: ₹${totalPrice}/month`;
                    
                    // Update button data
                    addToCartBtn.setAttribute('data-final-price', totalPrice);
                    addToCartBtn.setAttribute('data-duration', durationText);
                    addToCartBtn.setAttribute('data-addons', selectedAddons.join(', '));
                }
                
                if (durationSelect) durationSelect.addEventListener('change', updatePrice);
                if (ottCheckbox) ottCheckbox.addEventListener('change', updatePrice);
                if (iptvCheckbox) iptvCheckbox.addEventListener('change', updatePrice);
                
                // Initialize price
                updatePrice();
            });
        }

        // Plan selection and cart functionality
        function setupPlanSelection() {
            const addToCartButtons = document.querySelectorAll('.add-to-cart-btn');
            
            addToCartButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const company = this.getAttribute('data-company');
                    const planName = this.getAttribute('data-plan');
                    const finalPrice = parseInt(this.getAttribute('data-final-price')) || parseInt(this.getAttribute('data-base-price'));
                    const addons = this.getAttribute('data-addons') || '';
                    
                    const fullPlanName = `${company} - ${planName}${addons ? ' + ' + addons : ''}`;
                    
                    currentPlan = fullPlanName;
                    currentPrice = finalPrice;
                    cartCount = 1;
                    
                    // Update cart display
                    document.getElementById('cart-count').textContent = cartCount;
                    document.getElementById('cart-badge').classList.remove('hidden');
                    
                    // Show customer form
                    showCustomerForm();
                    
                    // Update selected plan display
                    document.getElementById('selected-plan-name').textContent = fullPlanName;
                    document.getElementById('selected-plan-price').textContent = `₹${finalPrice}/month`;
                });
            });
        }

        function showCustomerForm() {
            document.getElementById('plans-section').classList.add('hidden');
            document.getElementById('customer-form-section').classList.remove('hidden');
            document.getElementById('payment-section').classList.add('hidden');
            document.getElementById('success-section').classList.add('hidden');
        }

        function showPlansSection() {
            document.getElementById('plans-section').classList.remove('hidden');
            document.getElementById('customer-form-section').classList.add('hidden');
            document.getElementById('payment-section').classList.add('hidden');
            document.getElementById('success-section').classList.add('hidden');
        }

        function showPaymentSection() {
            document.getElementById('plans-section').classList.add('hidden');
            document.getElementById('customer-form-section').classList.add('hidden');
            document.getElementById('payment-section').classList.remove('hidden');
            document.getElementById('success-section').classList.add('hidden');
        }

        function showSuccessSection() {
            document.getElementById('plans-section').classList.add('hidden');
            document.getElementById('customer-form-section').classList.add('hidden');
            document.getElementById('payment-section').classList.add('hidden');
            document.getElementById('success-section').classList.remove('hidden');
        }

        // Form handling
        function setupFormHandling() {
            const customerForm = document.getElementById('customer-form');
            const backToPlansBtn = document.getElementById('back-to-plans');
            const backToFormBtn = document.getElementById('back-to-form');
            const completePaymentBtn = document.getElementById('complete-payment');
            const newOrderBtn = document.getElementById('new-order');
            const cartBtn = document.getElementById('cart-btn');

            customerForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const formData = new FormData(customerForm);
                currentOrderData = {
                    customer_name: formData.get('customer_name'),
                    mobile: formData.get('mobile'),
                    email: formData.get('email'),
                    address: formData.get('address'),
                    landmark: formData.get('landmark') || '',
                    pincode: formData.get('pincode'),
                    selected_plan: currentPlan,
                    plan_price: currentPrice,
                    order_date: new Date().toISOString(),
                    order_id: 'ORD' + Date.now()
                };
                
                // Update payment section
                document.getElementById('payment-plan-name').textContent = currentPlan;
                document.getElementById('payment-customer-name').textContent = currentOrderData.customer_name;
                document.getElementById('payment-amount').textContent = `₹${currentPrice}`;
                
                showPaymentSection();
            });

            backToPlansBtn.addEventListener('click', showPlansSection);
            backToFormBtn.addEventListener('click', showCustomerForm);
            
            completePaymentBtn.addEventListener('click', async function() {
                this.disabled = true;
                this.textContent = 'Processing...';
                
                try {
                    // Save order data
                    const result = await window.dataSdk.create(currentOrderData);
                    
                    if (result.isOk) {
                        document.getElementById('order-id').textContent = currentOrderData.order_id;
                        showSuccessSection();
                    } else {
                        // Show error message
                        const errorDiv = document.createElement('div');
                        errorDiv.className = 'bg-red-50 border border-red-200 rounded-lg p-4 mb-4';
                        errorDiv.innerHTML = '<p class="text-red-800">Order could not be saved. Please try again.</p>';
                        document.getElementById('payment-section').querySelector('.max-w-2xl').prepend(errorDiv);
                    }
                } catch (error) {
                    console.error('Payment error:', error);
                }
                
                this.disabled = false;
                this.textContent = 'Complete Payment (Demo)';
            });

            newOrderBtn.addEventListener('click', function() {
                // Reset state
                currentPlan = null;
                currentPrice = 0;
                cartCount = 0;
                currentOrderData = null;
                
                document.getElementById('cart-count').textContent = '0';
                document.getElementById('cart-badge').classList.add('hidden');
                customerForm.reset();
                
                showPlansSection();
            });

            cartBtn.addEventListener('click', function() {
                if (cartCount > 0) {
                    showCustomerForm();
                }
            });
        }

        // Initialize everything when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setupLocalitySelection();
            setupCompanyFiltering();
            setupPriceCalculation();
            setupPlanSelection();
            setupFormHandling();
        });
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9960151411a81c49',t:'MTc2MTcxMzc0NC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html><!-- Local Company Plans -->