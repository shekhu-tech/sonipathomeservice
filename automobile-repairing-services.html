<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SonipatHomeService.com - Automobile Repairing Services</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        :root {
            --primary: #212121;
            --secondary: #424242;
            --accent: #FFD700;
            --light: #f5f5f5;
            --dark: #212121;
            --success: #4caf50;
            --warning: #ff9800;
            --card-bg: #ffffff;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #333333 0%, #555555 100%);
            color: var(--light);
            line-height: 1.6;
            overflow-x: hidden;
        }

        main {
            padding-top: 6rem;
            max-width: 1700px;
            margin: 0 auto;
            padding: 6rem 1rem 3rem;
        }

        .lottery-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 0.625rem;
            padding: 1rem;
            text-align: center;
            backdrop-filter: blur(10px);
            transition: var(--transition);
            border: 1px solid rgba(255, 215, 0, 0.2);
        }

        .stat-card:hover {
            transform: translateY(-0.3125rem);
            box-shadow: var(--shadow);
            border-color: var(--accent);
        }

        .stat-card h3 {
            font-size: 0.95rem;
            margin-bottom: 0.3rem;
            color: var(--accent);
        }

        .stat-card p {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--light);
        }

        .product-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 0.9375rem;
            overflow: hidden;
            margin-bottom: 2rem;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 215, 0, 0.2);
        }

        .product-header {
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            padding: 1.25rem;
            text-align: center;
        }

        .product-header h2 {
            font-size: 1.75rem;
            margin-bottom: 0.5rem;
        }

        .product-content {
            display: flex;
            flex-wrap: wrap;
            padding: 1.5rem;
            align-items: center;
            justify-content: center;
            gap: 1.5rem;
        }

        .product-image {
            flex: 1;
            min-width: 280px;
            max-width: 100%;
            height: auto;
            border-radius: 0.625rem;
            overflow: hidden;
            background: url('https://placehold.co/600x400/212121/FFD700?text=Automobile+Repair') no-repeat center center;
            background-size: cover;
            min-height: 250px;
        }

        .product-details {
            flex: 2;
            min-width: 280px;
            padding: 1rem;
        }

        .price-container {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 1rem;
            margin: 1rem 0;
        }

        .original-price {
            font-size: 1.5rem;
            text-decoration: line-through;
            color: #b0b0b0;
        }

        .lottery-price {
            font-size: 2rem;
            font-weight: 700;
            color: var(--accent);
        }

        .features {
            margin: 1rem 0;
        }

        .features h3 {
            margin-bottom: 0.8rem;
            color: var(--accent);
        }

        .features ul {
            padding-left: 1.2rem;
        }

        .features li {
            margin-bottom: 0.4rem;
            font-size: 0.95rem;
        }

        .action-buttons {
            display: flex;
            gap: 0.8rem;
            flex-wrap: wrap;
            margin-top: 1.5rem;
        }

        .btn {
            padding: 0.75rem 1.25rem;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
            justify-content: center;
            flex-grow: 1;
            max-width: 100%;
        }

        .btn-primary {
            background: linear-gradient(90deg, var(--accent), #FFC107);
            color: #212121;
        }

        .btn-primary:hover {
            transform: translateY(-0.1875rem);
            box-shadow: 0 0.3125rem 0.9375rem rgba(255, 215, 0, 0.4);
        }

        .btn-secondary {
            background: transparent;
            color: var(--light);
            border: 2px solid var(--secondary);
        }

        .btn-secondary:hover {
            background: rgba(66, 66, 66, 0.2);
        }

        #popup-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            z-index: 999;
        }

        .popup {
            display: none;
            background: #212121;
            color: #fff;
            padding: 1.5rem;
            border-radius: 1.25rem;
            box-shadow: 0 0 1.875rem rgba(255, 215, 0, 0.5);
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
            width: 95%;
            max-width: 550px;
            max-height: 95vh;
            overflow-y: auto;
            animation: fadeIn 0.3s ease-out forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translate(-50%, -45%); }
            to { opacity: 1; transform: translate(-50%, -50%); }
        }

        #serviceCategorySelectionPopup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1001;
            background: #212121;
            color: #fff;
            padding: 1.5rem;
            border-radius: 1.25rem;
            box-shadow: 0 0 1.875rem rgba(255, 215, 0, 0.5);
            width: 95%;
            max-width: 550px;
            max-height: 95vh;
            overflow-y: auto;
            display: none;
        }

        #serviceCategoryCheckboxes {
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        }
        
        .popup input,
        .popup button,
        .popup select,
        .popup textarea {
            width: 100%;
            padding: 0.75rem;
            margin: 0.625rem 0;
            border-radius: 0.625rem;
            border: none;
            font-size: 1rem;
        }
        
        .popup input,
        .popup textarea {
            background: #f5f5f5;
            color: #000;
        }
        
        .popup textarea {
            min-height: 6.25rem;
            resize: vertical;
        }
        
        .popup label {
            display: block;
            margin-bottom: 0.3125rem;
            color: var(--accent);
            font-size: 0.95rem;
        }
        
        .popup button[type="submit"],
        .popup button#okayBtn,
        #razorpay-payment-btn,
        #downloadTicketsBtn {
            background: linear-gradient(90deg, var(--accent), #FFC107);
            color: #212121;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            padding: 0.75rem;
            margin-top: 0.9375rem;
            border-radius: 0.625rem;
            border: none;
            font-size: 1rem;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .popup button[type="submit"]:hover,
        .popup button#okayBtn:hover,
        #razorpay-payment-btn:hover,
        #downloadTicketsBtn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(255, 215, 0, 0.5);
        }
        
        #ticketDisplay {
            font-weight: bold;
            color: #FFECB3;
            font-size: 1.1rem;
            word-break: break-word;
            text-align: center;
            max-height: 12.5rem;
            overflow-y: auto;
            padding: 0.625rem;
            background: rgba(0,0,0,0.2);
            border-radius: 0.625rem;
            margin: 0.625rem 0;
        }

        #countryError {
            color: red;
            font-size: 0.8rem;
            display: none;
            margin-top: -0.3125rem;
            margin-bottom: 0.625rem;
        }

        #submitMessage {
            color: #FFECB3;
            font-size: 1rem;
            text-align: center;
            margin-top: 0.625rem;
            display: none;
        }
        
        #timerDisplay {
            font-size: 1.1rem;
            font-weight: bold;
            color: var(--accent);
            text-align: center;
            margin-top: 0.9375rem;
        }

        .quantity-selector {
            margin: 0.9375rem 0;
        }
        
        .quantity-selector label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--accent);
        }
        
        .quantity-info {
            display: flex;
            justify-content: space-between;
            margin-top: 0.3125rem;
            font-size: 0.85rem;
            color: #ccc;
        }
        
        .total-price {
            font-size: 1.1rem;
            font-weight: bold;
            color: var(--accent);
            text-align: right;
            margin: 0.625rem 0;
        }

        .custom-alert {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #FFC107;
            color: #212121;
            padding: 1.25rem 1.875rem;
            border-radius: 0.625rem;
            z-index: 1002;
            box-shadow: 0 0.3125rem 0.9375rem rgba(0,0,0,0.4);
            font-size: 1rem;
            text-align: center;
            max-width: 90%;
            animation: fadeInOut 4s forwards;
        }

        @keyframes fadeInOut {
            0% { opacity: 0; transform: translate(-50%, -40%); }
            10% { opacity: 1; transform: translate(-50%, -50%); }
            90% { opacity: 1; transform: translate(-50%, -50%); }
            100% { opacity: 0; transform: translate(-50%, -60%); display: none; }
        }

        @media (max-width: 1024px) {
            main { padding: 5rem 1rem 2rem; }
            .product-header h2 { font-size: 1.5rem; }
            .product-content { flex-direction: column; padding: 1rem; }
            .product-image { min-height: 200px; width: 100%; }
            .product-details { min-width: unset; width: 100%; text-align: center; }
            .price-container, .action-buttons { justify-content: center; }
            .btn { width: 100%; max-width: 300px; }
            .lottery-stats { grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); }
            .stat-card { padding: 0.8rem; }
            .stat-card h3 { font-size: 0.85rem; }
            .stat-card p { font-size: 1.3rem; }
            .popup { padding: 1rem; }
            .popup input, .popup button, .popup select, .popup textarea { font-size: 0.9rem; padding: 0.6rem; }
        }

        @media (max-width: 768px) {
            main { padding-top: 4rem; }
            .product-header h2 { font-size: 1.3rem; }
            .original-price { font-size: 1.3rem; }
            .lottery-price { font-size: 1.8rem; }
            .features li { font-size: 0.9rem; }
            .btn { font-size: 0.85rem; padding: 0.6rem 1rem; }
            .lottery-stats { grid-template-columns: 1fr 1fr; }
        }

        @media (max-width: 480px) {
            main { padding: 3rem 0.5rem 1rem; }
            .product-header h2 { font-size: 1.2rem; }
            .product-content { padding: 0.8rem; }
            .product-image { min-height: 180px; }
            .original-price { font-size: 1.2rem; }
            .lottery-price { font-size: 1.6rem; }
            .features ul { padding-left: 1rem; }
            .features li { font-size: 0.85rem; }
            .action-buttons { flex-direction: column; }
            .btn { width: 100%; max-width: unset; }
            .lottery-stats { grid-template-columns: 1fr; }
            .stat-card { padding: 0.7rem; }
            .stat-card h3 { font-size: 0.8rem; }
            .stat-card p { font-size: 1.1rem; }
            .popup { padding: 1rem; width: 98%; }
            .popup h2 { font-size: 1.3rem; }
            .popup input, .popup button, .popup select, .popup textarea { font-size: 0.85rem; padding: 0.5rem; }
            #ticketDisplay { font-size: 0.95rem; }
            .custom-alert { font-size: 0.9rem; padding: 1rem 1.5rem; }
        }
    </style>
</head>
<body>
   
    <main class="container mx-auto px-4 py-8">
        
        <section class="product-section rounded-2xl shadow-lg mb-8">
            <div class="product-header rounded-t-2xl">
                <h2 class="text-3xl md:text-4xl font-bold text-white">Automobile Repairing Services</h2>
            </div>

            <div class="product-content flex flex-col md:flex-row items-center justify-center p-6 md:p-8 gap-6">
                <div class="product-details w-full md:w-1/2 lg:w-3/5 text-center md:text-left">
                    <h3 class="text-2xl md:text-3xl font-semibold text-white mb-3">Professional Automobile Repair & Servicing</h3>
                    <p class="text-gray-300 mb-4 text-base md:text-lg">Get top-notch repair and servicing for your automobile. Select your car model and preferred service type below to see the transparent pricing. Our certified technicians ensure quality and efficient service to get you back on the road safely.</p>
                    
                    <div class="price-container flex flex-col md:flex-row items-center justify-center md:justify-start gap-4 my-6">
                        <div class="original-price text-gray-400 text-xl md:text-2xl line-through">Varies by model and service</div>
                        <div class="lottery-price text-accent text-3xl md:text-4xl font-bold" id="displayPrice">Select Car & Service Type</div>
                    </div>
                    
                    <div class="features text-left my-6">
                        <h3 class="text-xl md:text-2xl font-semibold text-accent mb-3">Service Features:</h3>
                        <ul class="list-disc list-inside text-gray-300 text-base md:text-lg space-y-2">
                            <li><i class="fas fa-check-circle text-green-400 mr-2"></i>Expert diagnosis and repair for various car issues</li>
                            <li><i class="fas fa-check-circle text-green-400 mr-2"></i>Certified technicians with extensive automotive experience</li>
                            <li><i class="fas fa-check-circle text-green-400 mr-2"></i>Transparent pricing for all services (Half Service & Full Service)</li>
                            <li><i class="fas fa-check-circle text-green-400 mr-2"></i>Use of genuine parts for replacements (cost extra)</li>
                            <li><i class="fas fa-check-circle text-green-400 mr-2"></i>Ensuring optimal vehicle performance and safety</li>
                            <li><i class="fas fa-check-circle text-green-400 mr-2"></i>Convenient scheduling and quick turnaround times</li>
                        </ul>
                        <h4 class="text-xl md:text-2xl font-semibold text-accent mt-6 mb-3">Half Service Includes:</h4>
                        <ul class="list-disc list-inside text-gray-300 text-base md:text-lg space-y-2">
                            <li><i class="fas fa-check-circle text-green-400 mr-2"></i>Synthetic Engine Oil Change</li>
                            <li><i class="fas fa-check-circle text-green-400 mr-2"></i>Air Filter Change</li>
                            <li><i class="fas fa-check-circle text-green-400 mr-2"></i>Oil Filter Change</li>
                            <li><i class="fas fa-check-circle text-green-400 mr-2"></i>Brake Oil Change</li>
                            <li><i class="fas fa-check-circle text-green-400 mr-2"></i>Wiper Shampoo </li>
                            <li><i class="fas fa-check-circle text-green-400 mr-2"></i>Battery Acid Check</Change/li>
                            <li><i class="fas fa-check-circle text-green-400 mr-2"></i>Spark Plug Clean Check/change</li>
                        </ul>
                        <h4 class="text-xl md:text-2xl font-semibold text-accent mt-6 mb-3">Full Service Includes:</h4>
                        <ul class="list-disc list-inside text-gray-300 text-base md:text-lg space-y-2">
                            <li><i class="fas fa-check-circle text-green-400 mr-2"></i>Synthetic Engine Oil Change</li>
                            <li><i class="fas fa-check-circle text-green-400 mr-2"></i>Air Filter Change</li>
                            <li><i class="fas fa-check-circle text-green-400 mr-2"></i>Oil Filter Change</li>
                            <li><i class="fas fa-check-circle text-green-400 mr-2"></i>Gear Oil Change</li>
                            <li><i class="fas fa-check-circle text-green-400 mr-2"></i>Coolant Change</li>
                            <li><i class="fas fa-check-circle text-green-400 mr-2"></i>Brake Grease Change</li>
                            <li><i class="fas fa-check-circle text-green-400 mr-2"></i>Engine Flush Check/change</li>
                            <li><i class="fas fa-check-circle text-green-400 mr-2"></i>Washing</li>
                            <li><i class="fas fa-check-circle text-green-400 mr-2"></i>AC Filter Change</li>
                            <li><i class="fas fa-check-circle text-green-400 mr-2"></i>Brake Oil checck /Change</li>
                            <li><i class="fas fa-check-circle text-green-400 mr-2"></i>Wiper Shampoo</li>
                            <li><i class="fas fa-check-circle text-green-400 mr-2"></i>Battery Acid Check/Change</li>
                            <li><i class="fas fa-check-circle text-green-400 mr-2"></i>Spark Plug Clean Check/Change</li>
                        </ul>
                    </div>
                    
                    <div class="action-buttons flex flex-col sm:flex-row justify-center md:justify-start gap-4 mt-8">
                        <button class="btn btn-primary shadow-lg hover:shadow-xl" id="participate-btn">
                            <i class="fas fa-car-side"></i> Book Automobile Service
                        </button>
                        <button class="btn btn-secondary shadow-lg hover:shadow-xl" onclick="window.open('index.html')">
                            <i class="fas fa-external-link-alt"></i> Go Back To Home
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <div class="lottery-stats grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
            <div class="stat-card rounded-xl shadow-lg">
                <h3 class="text-accent text-lg font-medium mb-1">Total Customers</h3>
                <p class="text-white text-3xl font-bold">28,500+</p>
            </div>
            <div class="stat-card rounded-xl shadow-lg">
                <h3 class="text-accent text-lg font-medium mb-1">Vehicles Serviced</h3>
                <p class="text-white text-3xl font-bold">1000+ Monthly</p>
            </div>
            <div class="stat-card rounded-xl shadow-lg">
                <h3 class="text-accent text-lg font-medium mb-1">Customer Rating</h3>
                <p class="text-white text-3xl font-bold">4.9/5 Stars</p>
            </div>
            <div class="stat-card rounded-xl shadow-lg">
                <h3 class="text-accent text-lg font-medium mb-1">Next Available Slot</h3>
                <p class="text-white text-3xl font-bold">Today!</p>
            </div>
        </div>
    </main>

    <div id="popup-overlay"></div>
    
    <div class="popup" id="popupForm">
        <h2 class="text-2xl font-bold text-center mb-4">Automobile Service Booking</h2>
        <form id="lotteryForm">
            <label for="fullName" class="text-accent text-sm mb-1">Your Full Name (min 10 characters)</label>
            <input type="text" id="fullName" name="field1" required placeholder="John Doe" autocomplete="name" minlength="10" class="rounded-lg bg-gray-100 text-gray-900 p-3 mb-3 focus:outline-none focus:ring-2 focus:ring-yellow-500" />
            
            <label for="phone" class="text-accent text-sm mb-1">Phone Number (10 digits)</label>
            <input type="tel" id="phone" name="field2" required placeholder="9876543210" autocomplete="tel" pattern="[0-9]{10}" class="rounded-lg bg-gray-100 text-gray-900 p-3 mb-3 focus:outline-none focus:ring-2 focus:ring-yellow-500" />
            
            <label for="email" class="text-accent text-sm mb-1">Email Address</label>
            <input type="email" id="email" name="field3" required placeholder="john.doe@example.com" autocomplete="email" class="rounded-lg bg-gray-100 text-gray-900 p-3 mb-3 focus:outline-none focus:ring-2 focus:ring-yellow-500" />
            
            <div class="mb-3">
                <label for="dobField" class="text-accent text-sm mb-1">Date of Birth:</label>
                <input type="date" id="dobField" name="field4" required class="rounded-lg bg-gray-100 text-gray-900 p-3 w-full focus:outline-none focus:ring-2 focus:ring-yellow-500" />
            </div>
            
            <label for="location" class="text-accent text-sm mb-1">Your Location (e.g. Sonipat, Delhi)</label>
            <input type="text" id="location" name="field5" required placeholder="Sonipat" autocomplete="address-level2" list="locations" class="rounded-lg bg-gray-100 text-gray-900 p-3 mb-3 focus:outline-none focus:ring-2 focus:ring-yellow-500" />
            
            <label for="address" class="text-accent text-sm mb-1">Complete Address (min 30 characters)</label>
            <textarea id="address" name="field6" required placeholder="House No, Street, Area, Landmark, City, State, PIN code" autocomplete="street-address" minlength="30" rows="4" class="rounded-lg bg-gray-100 text-gray-900 p-3 w-full mb-2 focus:outline-none focus:ring-2 focus:ring-yellow-500"></textarea>
            <span id="countryError" class="text-red-400 text-xs mt-1 hidden">Please enter your complete address with at least 30 characters.</span>
            
            <div class="quantity-selector my-4">
                <label class="text-accent text-sm mb-2">Select Car Model(s):</label>
                <div id="selectedServiceCategoriesDisplay" class="bg-gray-700 text-light p-3 rounded-lg cursor-pointer mb-3" onclick="openServiceCategorySelectionPopup()">Click to select car models</div>
                <div id="serviceCategorySelectionPopup" class="popup hidden">
                    <h3 class="text-xl font-bold text-center mb-4">Select Car Model(s)</h3>
                    <div id="serviceCategoryCheckboxes" class="grid grid-cols-2 sm:grid-cols-3 gap-2 text-light max-h-60 overflow-y-auto">
                        <!-- Checkboxes will be populated by JavaScript -->
                    </div>
                    <button type="button" class="btn btn-primary mt-4 py-2 rounded-xl font-bold text-lg" onclick="applySelectedServiceCategories()">Apply Selection</button>
                    <button type="button" class="btn btn-secondary mt-2 py-2 rounded-xl font-bold text-lg" onclick="closeServiceCategorySelectionPopup()">Cancel</button>
                </div>
            </div>

            <div class="quantity-selector my-4">
                <label class="text-accent text-sm mb-2">Select Service Type:</label>
                <div class="flex flex-col sm:flex-row gap-4 mt-2">
                    <label class="inline-flex items-center text-light">
                        <input type="radio" name="serviceTypeOption" value="Half Rate" class="form-radio text-yellow-500 h-5 w-5" checked>
                        <span class="ml-2">Half Service</span>
                    </label>
                    <label class="inline-flex items-center text-light">
                        <input type="radio" name="serviceTypeOption" value="Full Cost" class="form-radio text-yellow-500 h-5 w-5">
                        <span class="ml-2">Full Service</span>
                    </label>
                </div>
            </div>

            <div class="quantity-selector my-4">
                <label for="ticketQuantity" class="text-accent text-sm mb-2">Number of Services (Max 5):</label>
                <select id="ticketQuantity" name="ticketQuantity" required class="rounded-lg bg-gray-100 text-gray-900 p-3 w-full focus:outline-none focus:ring-2 focus:ring-yellow-500">
                    <option value="" disabled selected>Select quantity</option>
                    </select>
                <div class="quantity-info flex justify-between mt-2 text-gray-400 text-sm">
                    <span>Quantity based price</span>
                    <span class="total-price-quantity font-bold text-accent text-lg">Total: ₹0</span>
                </div>
            </div>

            <input type="hidden" name="ticket" id="ticketCode" />
            <input type="hidden" name="finalPrice" id="finalPrice" />
            <button type="submit" class="w-full btn-primary mt-4 py-3 rounded-xl font-bold text-lg transition-all duration-300 hover:scale-105 hover:shadow-xl">Submit Details</button>
            <span id="submitMessage" class="text-green-400 text-center mt-3 hidden">Submitting... Please wait</span>
        </form>
    </div>

    <div class="popup" id="paymentStep">
        <h2 class="text-2xl font-bold text-center mb-4">Complete Your Payment for Automobile Service</h2>
        <p class="text-gray-300 text-center mb-6">Please complete the payment to finalize your Automobile Service booking. Click the button below.</p>
        <div id="paymentSummary" class="bg-gray-800 p-4 rounded-lg mb-6 text-center"></div>
        <div id="timerDisplay" class="text-accent text-xl font-bold text-center mb-6">Time remaining: 05:00</div>
        <button id="razorpay-payment-btn" class="w-full btn-primary py-3 rounded-xl font-bold text-lg transition-all duration-300 hover:scale-105 hover:shadow-xl">Pay with Razorpay</button>
        <p class="mt-4 text-sm text-gray-400 text-center">
            After payment, please wait for automatic verification. Do not close this window.
        </p>
    </div>

    <div class="popup" id="ticketStep">
        <h2 id="welcomeMessage" class="text-2xl font-bold text-center mb-4 text-green-400"></h2>
        <p class="text-gray-300 text-center mb-4">You have successfully booked <span id="ticketCountDisplay" class="font-bold text-accent"></span>:</p>
        <div id="ticketDisplay" class="bg-gray-800 p-4 rounded-lg mb-6 text-center text-lg"></div>
        <button id="downloadTicketsBtn" class="w-full btn-primary py-3 rounded-xl font-bold text-lg transition-all duration-300 hover:scale-105 hover:shadow-xl">
            <i class="fas fa-download mr-2"></i> Download Service Details
        </button>
        <p class="mt-4 text-sm text-gray-400 text-center">📸 Please take a screenshot for proof and reference.</p>
        <button id="okayBtn" class="w-full btn-secondary py-3 rounded-xl font-bold text-white text-lg mt-4 transition-all duration-300 hover:scale-105 hover:bg-opacity-20">Okay, Got It!</button>
    </div>
   
    <script>
        // Data for Automobile services
        const serviceData = [
            { "Name": "Alto (Alto 800, Alto K10)", "Brand": "Maruti", "Half Rate": 2499, "Full Cost": 4499 },
            { "Name": "WagonR", "Brand": "Maruti", "Half Rate": 2499, "Full Cost": 4499 },
            { "Name": "Celerio", "Brand": "Maruti", "Half Rate": 2499, "Full Cost": 4499 },
            { "Name": "Swift", "Brand": "Maruti", "Half Rate": 2499, "Full Cost": 4499 },
            { "Name": "Dzire", "Brand": "Maruti", "Half Rate": 2499, "Full Cost": 4499 },
            { "Name": "Baleno", "Brand": "Maruti", "Half Rate": 2499, "Full Cost": 4499 },
            { "Name": "Ignis", "Brand": "Maruti", "Half Rate": 2499, "Full Cost": 4499 },
            { "Name": "A-Star (discontinued)", "Brand": "Maruti", "Half Rate": 2499, "Full Cost": 4499 },
            { "Name": "Ritz (discontinued)", "Brand": "Maruti", "Half Rate": 2499, "Full Cost": 4499 },
            { "Name": "Ciaz", "Brand": "Maruti", "Half Rate": 2499, "Full Cost": 4499 },
            { "Name": "Eeco", "Brand": "Maruti", "Half Rate": 3499, "Full Cost": 5499 },
            { "Name": "Ertiga", "Brand": "Maruti", "Half Rate": 2499, "Full Cost": 4499 },
            { "Name": "XL6", "Brand": "Maruti", "Half Rate": 2999, "Full Cost": 4999 },
            { "Name": "Brezza (Vitara Brezza earlier)", "Brand": "Maruti", "Half Rate": 2999, "Full Cost": 4999 },
            { "Name": "Grand Vitara", "Brand": "Maruti", "Half Rate": 2999, "Full Cost": 4999 },
            { "Name": "S-Cross (discontinued)", "Brand": "Maruti", "Half Rate": 2999, "Full Cost": 4999 },
            { "Name": "Jimny", "Brand": "Maruti", "Half Rate": 2999, "Full Cost": 4999 },
            { "Name": "Fronx", "Brand": "Maruti", "Half Rate": 2499, "Full Cost": 4499 },
            { "Name": "Venue", "Brand": "Hyundai", "Half Rate": 2499, "Full Cost": 4499 },
            { "Name": "Creta", "Brand": "Hyundai", "Half Rate": 2999, "Full Cost": 4999 },
            { "Name": "Grand i10 Nios", "Brand": "Hyundai", "Half Rate": 2499, "Full Cost": 4499 },
            { "Name": "i20", "Brand": "Hyundai", "Half Rate": 2499, "Full Cost": 4499 },
            { "Name": "Verna", "Brand": "Hyundai", "Half Rate": 2499, "Full Cost": 4499 },
            { "Name": "Alcazar", "Brand": "Hyundai", "Half Rate": 3399, "Full Cost": 5499 },
            { "Name": "Tucson", "Brand": "Hyundai", "Half Rate": 3399, "Full Cost": 5499 },
            { "Name": "Kona Electric", "Brand": "Hyundai", "Half Rate": 2499, "Full Cost": 4499 },
            { "Name": "Aura", "Brand": "Hyundai", "Half Rate": 2499, "Full Cost": 4499 },
            { "Name": "Santro (discontinued)", "Brand": "Hyundai", "Half Rate": 2499, "Full Cost": 4499 },
            { "Name": "Eon (discontinued)", "Brand": "Hyundai", "Half Rate": 2499, "Full Cost": 4499 },
            { "Name": "i10 (discontinued)", "Brand": "Hyundai", "Half Rate": 2499, "Full Cost": 4499 },
            { "Name": "i20 Active (discontinued)", "Brand": "Hyundai", "Half Rate": 2499, "Full Cost": 4499 },
            { "Name": "Xcent", "Brand": "Hyundai", "Half Rate": 2499, "Full Cost": 4499 },
            { "Name": "Bolero", "Brand": "Mahindra", "Half Rate": 3399, "Full Cost": 5499 },
            { "Name": "Scorpio N", "Brand": "Mahindra", "Half Rate": 3399, "Full Cost": 5499 },
            { "Name": "TUV300", "Brand": "Mahindra", "Half Rate": 2999, "Full Cost": 4999 },
            { "Name": "XUV500", "Brand": "Mahindra", "Half Rate": 3399, "Full Cost": 5499 },
            { "Name": "XUV700", "Brand": "Mahindra", "Half Rate": 3399, "Full Cost": 5499 },
            { "Name": "Etios", "Brand": "Toyota", "Half Rate": 2499, "Full Cost": 4499 },
            { "Name": "Glenza", "Brand": "Toyota", "Half Rate": 2499, "Full Cost": 4499 }
        ];

        // --- Generic constants for the service page ---
        const SERVICE_NAME = "Automobile Service";
        const SERVICE_TAB_ID = "shs-service";
        const SERVICE_FORM_DATA_KEY = "carModel";
        const RAZORPAY_IMAGE_TEXT = "AR";

        // --- DOM Element Selection ---
        const participateBtn = document.getElementById('participate-btn');
        const popupOverlay = document.getElementById('popup-overlay');
        const allPopups = document.querySelectorAll('.popup');
        const popupForm = document.getElementById('popupForm');
        const paymentStep = document.getElementById('paymentStep');
        const ticketStep = document.getElementById('ticketStep');
        const timerDisplay = document.getElementById('timerDisplay');
        const razorpayBtn = document.getElementById('razorpay-payment-btn');
        const submitMessage = document.getElementById('submitMessage');
        const serviceCategoryCheckboxesContainer = document.getElementById('serviceCategoryCheckboxes');
        const selectedServiceCategoriesDisplay = document.getElementById('selectedServiceCategoriesDisplay');
        const serviceCategorySelectionPopup = document.getElementById('serviceCategorySelectionPopup');
        const serviceTypeOptions = document.querySelectorAll('input[name="serviceTypeOption"]');
        const ticketQuantitySelect = document.getElementById('ticketQuantity');
        const totalPriceQuantityDisplay = document.querySelector('.total-price-quantity');
        const paymentSummary = document.getElementById('paymentSummary');
        const ticketCountDisplay = document.getElementById('ticketCountDisplay');
        const downloadTicketsBtn = document.getElementById('downloadTicketsBtn');
        const welcomeMessage = document.getElementById('welcomeMessage');
        const displayPriceElement = document.getElementById('displayPrice');
        const finalPriceInput = document.getElementById('finalPrice');
        const form = document.getElementById('lotteryForm');
        const ticketInput = document.getElementById('ticketCode');
        const ticketDisplay = document.getElementById('ticketDisplay');
        const okayBtn = document.getElementById('okayBtn');

        // --- State Variables ---
        let generatedTicket = ''; 
        let paymentTimeout = null;
        let countdownInterval = null;
        const PAYMENT_TIME_LIMIT = 5 * 60; // 5 minutes
        let currentServicePrice = 0;
        let selectedQuantity = 1;
        let allowClose = false;

        // --- Core Functions ---

        function populateServiceCategories() {
            serviceCategoryCheckboxesContainer.innerHTML = '';
            serviceData.forEach(service => {
                const checkboxHtml = `
                    <label class="inline-flex items-center text-light w-full">
                        <input type="checkbox" name="serviceCategory" value="${service.Name}" 
                               data-half-rate="${service['Half Rate']}" data-full-cost="${service['Full Cost']}"
                               class="form-checkbox h-5 w-5 text-yellow-500 rounded focus:ring-yellow-500">
                        <span class="ml-2">${service.Name} (${service.Brand})</span>
                    </label>
                `;
                serviceCategoryCheckboxesContainer.insertAdjacentHTML('beforeend', checkboxHtml);
            });
            serviceCategoryCheckboxesContainer.querySelectorAll('input[name="serviceCategory"]').forEach(checkbox => {
                checkbox.addEventListener('change', updatePrices);
            });
        }

        function initQuantitySelector() {
            const maxServices = 5; 
            ticketQuantitySelect.innerHTML = '<option value="" disabled>Select quantity</option>';
            for (let i = 1; i <= maxServices; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = i + (i === 1 ? ' service' : ' services');
                ticketQuantitySelect.appendChild(option);
            }
            ticketQuantitySelect.value = 1;
        }

        function updatePrices() {
            const selectedCategories = Array.from(serviceCategoryCheckboxesContainer.querySelectorAll('input[name="serviceCategory"]:checked'));
            const selectedServiceType = document.querySelector('input[name="serviceTypeOption"]:checked')?.value;
            selectedQuantity = parseInt(ticketQuantitySelect.value) || 1;
            
            let totalCalculatedPrice = 0;

            if (selectedCategories.length > 0 && selectedServiceType) {
                selectedCategories.forEach(checkbox => {
                    if (selectedServiceType === "Half Rate") {
                        totalCalculatedPrice += parseFloat(checkbox.dataset.halfRate);
                    } else if (selectedServiceType === "Full Cost") {
                        totalCalculatedPrice += parseFloat(checkbox.dataset.fullCost);
                    }
                });
            }
            
            currentServicePrice = totalCalculatedPrice;
            const totalFinalPrice = currentServicePrice * selectedQuantity;

            if (selectedCategories.length > 0) {
                selectedServiceCategoriesDisplay.textContent = selectedCategories.map(cb => cb.value).join(', ');
                displayPriceElement.textContent = `Service Charge: ₹${currentServicePrice}`;
            } else {
                selectedServiceCategoriesDisplay.textContent = `Click to select ${SERVICE_NAME} category`;
                displayPriceElement.textContent = `Select Car & Service Type`;
            }
            
            totalPriceQuantityDisplay.textContent = `Total: ₹${totalFinalPrice}`;
            finalPriceInput.value = totalFinalPrice;
        }

        function generateFormattedTicket() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, c => {
                const r = Math.random() * 16 | 0;
                const v = c === 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            }).toUpperCase();
        }

        function downloadTickets() {
            const selectedCategoryNames = Array.from(serviceCategoryCheckboxesContainer.querySelectorAll('input[name="serviceCategory"]:checked')).map(cb => cb.value).join(', ');
            const serviceTypeName = document.querySelector('input[name="serviceTypeOption"]:checked')?.value === "Half Rate" ? "Half Service" : "Full Service";
            
            const ticketContent = `${SERVICE_NAME} Booking Details\n\n` +
                                 `Customer Name: ${form.field1.value}\n` +
                                 `Contact: ${form.field2.value}\n` +
                                 `Location: ${form.field5.value}\n` +
                                 `Car Model(s): ${selectedCategoryNames}\n` +
                                 `Service Type: ${serviceTypeName}\n` +
                                 `Booking Reference Number: ${generatedTicket}\n\n` + 
                                 `Total Services: ${selectedQuantity}\n` +
                                 `Service Charge: ₹${finalPriceInput.value}\n\n` +
                                 `Note: Final charges for parts and labor will be communicated by the technician after diagnosis.`;
            
            const blob = new Blob([ticketContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${SERVICE_TAB_ID}_booking.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        function showCustomAlert(message) {
            const alertBox = document.createElement('div');
            alertBox.className = 'custom-alert'; 
            alertBox.textContent = message;
            document.body.appendChild(alertBox);
            setTimeout(() => alertBox.remove(), 4000); 
        }

        function closeAllPopups() {
            if (!allowClose) {
                showCustomAlert("Please complete the process before closing.");
                return;
            }
            clearTimers();
            popupOverlay.style.display = 'none';
            allPopups.forEach(p => p.style.display = 'none');
            document.body.style.overflow = 'auto';
            allowClose = false; 
        }

        function openPopup(popupElement) {
            document.body.style.overflow = 'hidden';
            popupOverlay.style.display = 'block';
            popupElement.style.display = 'block';
            allowClose = false;
        }

        function openServiceCategorySelectionPopup() {
            populateServiceCategories();
            const currentlySelected = selectedServiceCategoriesDisplay.textContent.split(', ').map(s => s.trim());
            serviceCategoryCheckboxesContainer.querySelectorAll('input[name="serviceCategory"]').forEach(cb => {
                cb.checked = currentlySelected.includes(cb.value);
            });
            serviceCategorySelectionPopup.style.display = 'block';
            popupOverlay.style.display = 'block';
            document.body.style.overflow = 'hidden';
        }

        function closeServiceCategorySelectionPopup() {
            serviceCategorySelectionPopup.style.display = 'none';
            if (popupForm.style.display !== 'block') {
                popupOverlay.style.display = 'none';
                document.body.style.overflow = 'auto';
            }
        }

        function applySelectedServiceCategories() {
            updatePrices();
            closeServiceCategorySelectionPopup();
        }
        
        function clearTimers() {
            if (paymentTimeout) clearTimeout(paymentTimeout);
            if (countdownInterval) clearInterval(countdownInterval);
        }

        function startPaymentTimer() {
            let timeLeft = PAYMENT_TIME_LIMIT;
            const updateDisplay = () => {
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                timerDisplay.textContent = `Time remaining: ${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            };
            updateDisplay();

            countdownInterval = setInterval(() => {
                timeLeft--;
                updateDisplay();
                if (timeLeft <= 0) {
                    clearInterval(countdownInterval);
                    showCustomAlert("Payment time expired. Please try again.");
                    allowClose = true; 
                    closeAllPopups();
                }
            }, 1000);
        }
        
        function handleFormSubmit(e) {
            e.preventDefault();

            if (form.fullName.value.trim().length < 10) { showCustomAlert("Please enter your full name (minimum 10 characters)."); return; }
            if (!/^\d{10}$/.test(form.phone.value.trim())) { showCustomAlert("Please enter a valid 10-digit phone number."); return; }
            if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(form.email.value.trim())) { showCustomAlert("Please enter a valid email address."); return; }
            if (!form.dobField.value) { showCustomAlert("Please select your date of birth."); return; }
            if (form.location.value.trim().length < 3) { showCustomAlert("Please enter a valid location name."); return; }
            if (form.address.value.trim().length < 30) { showCustomAlert("Please enter a complete address with at least 30 characters."); return; }
            const selectedCategories = Array.from(serviceCategoryCheckboxesContainer.querySelectorAll('input[name="serviceCategory"]:checked'));
            if (selectedCategories.length === 0) { showCustomAlert(`Please select at least one Car Model.`); return; }
            if (!ticketQuantitySelect.value || parseInt(ticketQuantitySelect.value) <= 0) { showCustomAlert("Please select the number of services."); return; }

            submitMessage.style.display = 'block';
            form.querySelector('button[type="submit"]').disabled = true;

            generatedTicket = generateFormattedTicket(); 
            
            const formData = new FormData();
            formData.append('field1', form.fullName.value);
            formData.append('field2', form.phone.value);
            formData.append('field3', form.email.value);
            formData.append('field4', form.dobField.value);
            formData.append('field5', form.location.value);
            formData.append('field6', form.address.value);
            formData.append('ticket', generatedTicket);
            formData.append('tab', SERVICE_TAB_ID);
            formData.append(SERVICE_FORM_DATA_KEY, selectedCategories.map(cb => cb.value).join(', '));
            formData.append('serviceType', document.querySelector('input[name="serviceTypeOption"]:checked')?.value === "Half Rate" ? "Half Service" : "Full Service");
            formData.append('servicePrice', currentServicePrice);
            formData.append('ticketQuantity', selectedQuantity);
            
            fetch("https://script.google.com/macros/s/AKfycbzq42I1bYVh-lUSFp_BMC9I99g_HuQQKGLs39iEhaDZOowVGcIRuytnOIQaH_sG-8SwfQ/exec", {
                method: "POST",
                body: formData
            })
            .then(res => res.text())
            .then(res => {
                if (res === "Success") {
                    popupForm.style.display = 'none';
                    openPopup(paymentStep);
                    const selectedCategoryNames = selectedCategories.map(cb => cb.value).join(', ');
                    const serviceTypeName = document.querySelector('input[name="serviceTypeOption"]:checked')?.value === "Half Rate" ? "Half Service" : "Full Service";
                    paymentSummary.innerHTML = `
                        <p class="text-gray-300 text-lg mb-2">You are booking <span class="font-bold text-accent">${selectedQuantity}</span> ${serviceTypeName} for ${selectedCategoryNames}.</p>
                        <p class="total-price text-accent text-2xl font-bold">Service Charge: ₹${finalPriceInput.value}</p>
                        <p class="text-gray-400 text-sm mt-2">Final charges for parts and labor will be communicated by the technician after diagnosis.</p>
                    `;
                    startPaymentTimer();
                } else {
                    showCustomAlert("There was an error submitting your form. Please try again.");
                }
            })
            .catch(err => {
                console.error("Submission error:", err);
                showCustomAlert("An unexpected error occurred. Please check your connection and try again.");
            })
            .finally(() => {
                submitMessage.style.display = 'none';
                form.querySelector('button[type="submit"]').disabled = false;
            });
        }

        function handleRazorpayPayment() {
            const selectedCategoryNames = Array.from(serviceCategoryCheckboxesContainer.querySelectorAll('input[name="serviceCategory"]:checked')).map(cb => cb.value).join(', ');
            const serviceTypeName = document.querySelector('input[name="serviceTypeOption"]:checked')?.value === "Half Rate" ? "Half Service" : "Full Service";
            const options = {
                "key": "rzp_live_opiqkRmGpjG1hF",
                "amount": finalPriceInput.value * 100,
                "currency": "INR",
                "name": `SonipatHomeService - ${SERVICE_NAME}`,
                "description": `Payment for ${selectedQuantity} ${serviceTypeName}(s) for ${selectedCategoryNames}`,
                "image": `https://placehold.co/100x100/212121/FFD700?text=${RAZORPAY_IMAGE_TEXT}`,
                "handler": function (response){
                    console.log("Payment successful:", response.razorpay_payment_id);
                    paymentSuccess();
                },
                "prefill": {
                    "name": form.fullName.value,
                    "email": form.email.value,
                    "contact": form.phone.value
                },
                "notes": {
                    "address": `${form.location.value}, ${form.address.value}`,
                    "service_details": selectedCategoryNames,
                },
                "theme": {
                    "color": "#212121"
                },
                "modal": {
                    "ondismiss": () => console.log('Razorpay checkout modal closed.')
                }
            };

            const rzp = new Razorpay(options);
            rzp.on('payment.failed', response => {
                console.error("Payment Failed:", response.error);
                showCustomAlert(`Payment Failed: ${response.error.description} (Code: ${response.error.code})`);
            });
            rzp.open();
        }

        function paymentSuccess() {
            clearTimers();
            paymentStep.style.display = 'none';
            openPopup(ticketStep);
            
            const userName = form.fullName.value;
            const selectedCategoryNames = Array.from(serviceCategoryCheckboxesContainer.querySelectorAll('input[name="serviceCategory"]:checked')).map(cb => cb.value).join(', ');
            const serviceTypeName = document.querySelector('input[name="serviceTypeOption"]:checked')?.value === "Half Rate" ? "Half Service" : "Full Service";

            welcomeMessage.textContent = `🎉 Congratulations, ${userName}! Your ${serviceTypeName} Booking for ${selectedCategoryNames} is Confirmed! 🎉`;
            
            ticketDisplay.innerHTML = `
                <p>Registration ID: <span class="text-white">${generatedTicket}</span></p>
                <p>Service: <span class="text-white">${serviceTypeName} for ${selectedCategoryNames}</span></p>
                <p>Quantity: <span class="text-white">${selectedQuantity}</span></p>
                <p class="text-gray-400 text-sm mt-2">Service Charge: ₹${finalPriceInput.value}</p>
                <p class="text-gray-400 text-sm">Final charges for parts and labor will be communicated by the technician after diagnosis.</p>
            `;
            
            ticketCountDisplay.textContent = `${selectedQuantity} ${serviceTypeName}(s)`;
            allowClose = true;
        }
        
        participateBtn.addEventListener('click', () => {
            initQuantitySelector();
            updatePrices();
            openPopup(popupForm);
        });
        
        ticketQuantitySelect.addEventListener('change', updatePrices); 
        serviceTypeOptions.forEach(radio => radio.addEventListener('change', updatePrices));

        popupOverlay.addEventListener('click', e => {
            if (e.target === popupOverlay) {
                if (serviceCategorySelectionPopup.style.display === 'block') {
                    closeServiceCategorySelectionPopup();
                } else if (ticketStep.style.display === 'block' && allowClose) {
                    closeAllPopups();
                } else {
                    showCustomAlert("Please complete the form or payment process before closing.");
                }
            }
        });
        
        okayBtn.addEventListener('click', () => window.location.href = 'index.html');
        razorpayBtn.addEventListener('click', handleRazorpayPayment);
        downloadTicketsBtn.addEventListener('click', downloadTickets);
        form.addEventListener('submit', handleFormSubmit);

        document.addEventListener('DOMContentLoaded', () => {
            populateServiceCategories();
            initQuantitySelector();
            updatePrices();
        });
    </script>
</body>
</html>
